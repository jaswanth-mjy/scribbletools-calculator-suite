<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScribbleTools: Free Online Calculators & Tools for Math, Text, Finance, Health</title>
    <meta name="description" content="ScribbleTools is the professional, ad-free toolbox for math, text, finance, health, and more. Fast, privacy-first, and always free. Trusted by students, teachers, and professionals.">
    <meta name="keywords" content="online calculator, math calculator, area calculator, volume calculator, perimeter calculator, surface area calculator, text tools, financial calculator, health calculator, free utilities, ad-free tools, privacy-first tools, professional calculators">
    <meta name="robots" content="index, follow">
    <meta name="author" content="ScribbleTools Team">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <link rel="canonical" href="https://scribbletools.com/">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta name="theme-color" content="#D9534F">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="website">
    <meta property="og:title" content="ScribbleTools: Free Online Calculators & Tools for Math, Text, Finance, Health">
    <meta property="og:description" content="ScribbleTools is the professional, ad-free toolbox for math, text, finance, health, and more. Fast, privacy-first, and always free. Trusted by students, teachers, and professionals.">
    <meta property="og:url" content="https://scribbletools.com/">
    <meta property="og:site_name" content="ScribbleTools">
    <meta property="og:image" content="https://scribbletools.com/assets/og-image.svg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ScribbleTools: Free Online Calculators & Tools for Math, Text, Finance, Health">
    <meta name="twitter:description" content="ScribbleTools is the professional, ad-free toolbox for math, text, finance, health, and more. Fast, privacy-first, and always free. Trusted by students, teachers, and professionals.">
    <meta name="twitter:image" content="https://scribbletools.com/assets/og-image.svg">
    <meta name="twitter:site" content="@scribbletools">
    <meta name="twitter:creator" content="@scribbletools">
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "ScribbleTools",
      "url": "https://scribbletools.com/",
      "description": "ScribbleTools is the professional, ad-free toolbox for math, text, finance, health, and more. Fast, privacy-first, and always free.",
      "inLanguage": "en",
      "publisher": {
        "@type": "Organization",
        "name": "ScribbleTools Team",
        "url": "https://scribbletools.com/"
      },
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://scribbletools.com/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    <!-- Configuration -->
    <script src="config.js"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID', {
            page_title: document.title,
            page_location: window.location.href
        });
    </script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <!-- Google Fonts: Caveat for handwritten style, and Poppins for readability -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Hand-drawn & Bold Theme --- */
        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: #F8F4E8; /* Creamy paper background */
            color: #4A4A4A; /* Dark charcoal text */
        }
        
        .handwritten {
            font-family: 'Caveat', cursive;
        }
        
        /* --- Page Load & Content Transition --- */
        #app-container > * { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #D9534F; /* A warm, friendly red */
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* --- Professional Dropdown Navigation Styles --- */
        .nav-category summary {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.1rem;
            font-weight: 700; /* Bolder subheadings */
            color: #333;
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s;
            list-style: none;
        }
        .nav-category summary::-webkit-details-marker { display: none; }
        .nav-category summary:hover { background-color: #EFEAE0; }
        .nav-category summary .arrow { margin-left: auto; transition: transform 0.2s; }
        .nav-category[open] > summary .arrow { transform: rotate(90deg); }
        .nav-category[open] > summary { background-color: #EAE3D5; }
        
        .nav-links {
            padding-left: 1rem;
            border-left: 2px solid #DCD5C3;
            margin-left: 0.75rem;
            margin-top: 0.5rem;
        }
        
        .nav-link {
            display: block;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.9rem;
            color: #6C6C6C;
            transition: all 0.2s;
            font-weight: 500;
        }
        .nav-link:hover { background-color: #EFEAE0; color: #333; }
        .nav-link.active { background-color: #D9534F; color: white; }

        /* --- Nested Dropdown Styles --- */
        .nav-subcategory summary {
            font-size: 0.9rem;
            padding: 0.6rem;
            gap: 0.5rem;
            font-weight: 600;
        }
        .nav-subcategory .nav-links {
             margin-left: 0.75rem;
             padding-left: 0.75rem;
        }
        .sub-nav-link {
            font-size: 0.85rem;
            padding-left: 1rem;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body class="antialiased">

    <div class="min-h-screen flex flex-col">
        <!-- Header Navigation -->
        <header class="w-full bg-white shadow-sm border-b border-gray-200">
            <div class="container mx-auto flex justify-between items-center py-4 px-4">
                <a href="#home" id="logo-link" class="handwritten text-3xl text-[#D9534F] hover:underline focus:outline-none" style="cursor:pointer;">ScribbleTools</a>
                <div class="flex items-center gap-8">
                    <nav class="flex gap-4 sidebar-nav hover:w-auto transition-all duration-200">
                        <a href="#about" class="nav-link flex items-center"><span class="sidebar-label">About</span></a>
                        <a href="#blogs" class="nav-link flex items-center"><span class="sidebar-label">Blogs</span></a>
                        <a href="#all-tools" class="nav-link flex items-center"><span class="sidebar-label">Keymap</span></a>
                        <a href="#feedback" class="nav-link flex items-center"><span class="sidebar-label">Feedback</span></a>
                        <a href="#contact" class="nav-link flex items-center"><span class="sidebar-label">Contact</span></a>
                        <a href="#request-tool" class="nav-link flex items-center"><span class="sidebar-label">Request a Tool</span></a>
                    </nav>
                </div>
            </div>
        </header>
        <!-- Main Content Area -->
        <div class="container mx-auto px-4 py-8 flex-grow">
            <div class="flex flex-col md:flex-row gap-8">
                
                <!-- Sidebar Navigation -->
                <aside class="w-full md:w-1/4 lg:w-1/5">
                     <nav id="tool-nav" class="flex flex-col space-y-2">
                        <!-- Search Bar at top -->
                        <div class="relative mb-4 px-2">
                            <input type="text" id="tool-search" placeholder="Find a tool..." class="w-full p-2 pl-8 border-2 border-gray-300 rounded-md bg-white focus:border-red-400 focus:ring-0">
                            <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.15 4.906l3.44 3.44a.75.75 0 1 1-1.06 1.06l-3.44-3.44A7 7 0 0 1 2 9Z" clip-rule="evenodd" /></svg>
                        </div>

                        <!-- Main Tool Categories at top -->
                        <details class="nav-category" open>
                            <summary><span>Text Tools</span><span class="arrow">▶</span></summary>
                            <div class="nav-links flex flex-col space-y-1 mt-2">
                                <details class="nav-subcategory"><summary><span>Manipulation</span><span class="arrow">▶</span></summary><div class="nav-links flex flex-col space-y-1 mt-2">
                                    <a href="#change-case" class="nav-link sub-nav-link">Change Case</a>
                                    <a href="#find-replace" class="nav-link sub-nav-link">Find & Replace</a>
                                    <a href="#reverse-text" class="nav-link sub-nav-link">Reverse Text</a>
                                    <a href="#split-text" class="nav-link sub-nav-link">Split Text</a>
                                    <a href="#join-text" class="nav-link sub-nav-link">Join Text</a>
                                    <a href="#repeat-text" class="nav-link sub-nav-link">Repeat Text</a>
                                    <a href="#sort-lines" class="nav-link sub-nav-link">Sort Lines (A-Z, Z-A, Random)</a>
                                    <a href="#shuffle-lines" class="nav-link sub-nav-link">Shuffle Lines</a>
                                    <a href="#remove-punctuation" class="nav-link sub-nav-link">Remove Punctuation</a>
                                    <a href="#text-indenter" class="nav-link sub-nav-link">Text Indenter/Unindenter</a>
                                    <a href="#text-dedenter" class="nav-link sub-nav-link">Text Dedenter</a>
                                    <a href="#text-justifier" class="nav-link sub-nav-link">Text Justifier (Full Justify)</a>
                                    <a href="#rot13" class="nav-link sub-nav-link">ROT13 Encoder/Decoder</a>
                                    <a href="#text-scrambler" class="nav-link sub-nav-link">Text Scrambler/Unscrambler</a>
                                </div></details>
                                <details class="nav-subcategory"><summary><span>Formatting</span><span class="arrow">▶</span></summary><div class="nav-links flex flex-col space-y-1 mt-2">
                                    <a href="#trim-whitespace" class="nav-link sub-nav-link">Trim Whitespace</a>
                                    <a href="#trim-whitespace" class="nav-link sub-nav-link">Trim Whitespace</a>
                                    <a href="#align-text" class="nav-link sub-nav-link">Align Text</a>
                                    <a href="#word-wrap" class="nav-link sub-nav-link">Word Wrap</a>
                                    <a href="#add-line-numbers" class="nav-link sub-nav-link">Add Line Numbers</a>
                                    <a href="#change-font" class="nav-link sub-nav-link">Change Font</a>
                                    <a href="#json-formatter-minifier" class="nav-link sub-nav-link">JSON Formatter/Minifier</a>
                                    <a href="#xml-formatter-minifier" class="nav-link sub-nav-link">XML Formatter/Minifier</a>
                                    <a href="#csv-json-converter" class="nav-link sub-nav-link">CSV ⇄ JSON Converter</a>
                                    <a href="#html-encode-decode" class="nav-link sub-nav-link">HTML Encode/Decode</a>
                                    <a href="#lorem-ipsum-generator" class="nav-link sub-nav-link">Lorem Ipsum Generator</a>
                                    <a href="#text-to-ascii-art" class="nav-link sub-nav-link">Text to ASCII Art</a>
                                </div></details>
                                <details class="nav-subcategory"><summary><span>Analysis</span><span class="arrow">▶</span></summary><div class="nav-links flex flex-col space-y-1 mt-2">
                                    <a href="#word-counter" class="nav-link sub-nav-link">Word Counter</a>
                                    <a href="#text-statistics" class="nav-link sub-nav-link">Text Statistics</a>
                                    <a href="#find-top-words" class="nav-link sub-nav-link">Find Top Words</a>
                                    <a href="#keyword-density" class="nav-link sub-nav-link">Keyword Density Analyzer</a>
                                    <a href="#unique-word-finder" class="nav-link sub-nav-link">Unique Word Finder</a>
                                    <a href="#readability-score" class="nav-link sub-nav-link">Readability Score</a>
                                </div></details>
                                <details class="nav-subcategory"><summary><span>Encoding/Other</span><span class="arrow">▶</span></summary><div class="nav-links flex flex-col space-y-1 mt-2">
                                    <a href="#zalgo-text" class="nav-link sub-nav-link">Zalgo Text</a>
                                    <a href="#image-from-text" class="nav-link sub-nav-link">Image from Text</a>
                                    <a href="#url-encode" class="nav-link sub-nav-link">URL Encode</a>
                                    <a href="#base64-encode" class="nav-link sub-nav-link">Base64 Encode</a>
                                    <a href="#remove-duplicate-lines" class="nav-link sub-nav-link">Remove Duplicate Lines</a>
                                    <a href="#morse-code" class="nav-link sub-nav-link">Morse Code</a>
                                    <a href="#text-diff-checker" class="nav-link sub-nav-link">Text Diff Checker</a>
                                    <a href="#unicode-converter" class="nav-link sub-nav-link">Unicode Converter</a>
                                    <a href="#binary-hex-octal-converter" class="nav-link sub-nav-link">Binary/Hex/Octal Converter</a>
                                    <a href="#upside-down-text" class="nav-link sub-nav-link">Upside Down Text</a>
                                    <a href="#mirror-text" class="nav-link sub-nav-link">Mirror Text</a>
                                    <a href="#bubble-text" class="nav-link sub-nav-link">Bubble Text</a>
                                    <a href="#fancy-unicode-text-generator" class="nav-link sub-nav-link">Fancy Unicode Text Generator</a>
                                    <a href="#emoji-replacer-inserter" class="nav-link sub-nav-link">Emoji Replacer/Inserter</a>
                                    <a href="#text-to-qr-code" class="nav-link sub-nav-link">Text to QR Code</a>
                                </div></details>
                            </div>
                        </details>

                        <details class="nav-category">
                            <summary><span>Math Calculators</span><span class="arrow">▶</span></summary>
                            <div class="nav-links flex flex-col space-y-1 mt-2">
                                <details class="nav-subcategory"><summary><span>Basic & Algebra</span><span class="arrow">▶</span></summary><div class="nav-links flex flex-col space-y-1 mt-2">
                                    <a href="#basic-calculator" class="nav-link sub-nav-link">Basic Calculator</a>
                                    <a href="#square-root-calculator" class="nav-link sub-nav-link">Square Root Calculator</a>
                                    <a href="#exponent-calculator" class="nav-link sub-nav-link">Exponent/Power Calculator</a>
                                    <a href="#fraction-calculator" class="nav-link sub-nav-link">Fraction Calculator</a>
                                    <a href="#percentage-calculator" class="nav-link sub-nav-link">Percentage Calculator</a>
                                    <a href="#discount-calculator" class="nav-link sub-nav-link">Discount Calculator</a>
                                    <a href="#tip-calculator" class="nav-link sub-nav-link">Tip Calculator</a>
                                    <a href="#simple-interest-calculator" class="nav-link sub-nav-link">Simple Interest Calculator</a>
                                    <a href="#unit-price-calculator" class="nav-link sub-nav-link">Unit Price Calculator</a>
                                    <a href="#scientific-notation-converter" class="nav-link sub-nav-link">Scientific Notation Converter</a>
                                </div></details>
                                <details class="nav-subcategory"><summary><span>Geometry</span><span class="arrow">▶</span></summary><div class="nav-links flex flex-col space-y-1 mt-2">
                                    <a href="#area-calculator" class="nav-link sub-nav-link">Area Calculator</a>
                                    <a href="#perimeter-calculator" class="nav-link sub-nav-link">Perimeter Calculator</a>
                                    <a href="#volume-calculator" class="nav-link sub-nav-link">Volume Calculator</a>
                                    <a href="#lateral-surface-area-calculator" class="nav-link sub-nav-link">Lateral Surface Area Calculator</a>
                                    <a href="#total-surface-area-calculator" class="nav-link sub-nav-link">Total Surface Area Calculator</a>
                                    <a href="#circle-calculator" class="nav-link sub-nav-link">Circle Calculator</a>
                                    <a href="#triangle-calculator" class="nav-link sub-nav-link">Triangle Calculator</a>
                                    <a href="#sphere-calculator" class="nav-link sub-nav-link">Sphere Calculator</a>
                                    <a href="#cylinder-calculator" class="nav-link sub-nav-link">Cylinder Calculator</a>
                                    <a href="#polygon-calculator" class="nav-link sub-nav-link">Polygon Calculator</a>
                                    <a href="#rectangle-calculator" class="nav-link sub-nav-link">Rectangle Calculator</a>
                                    <a href="#cuboid-calculator" class="nav-link sub-nav-link">Cuboid Calculator</a>
                                </div></details>
                                <details class="nav-subcategory" open><summary><span>Statistics</span><span class="arrow">▶</span></summary><div class="nav-links flex flex-col space-y-1 mt-2">
                                    <a href="#standard-deviation-calculator" class="nav-link sub-nav-link">Standard Deviation Calculator</a>
                                    <a href="#number-sequence-calculator" class="nav-link sub-nav-link">Number Sequence Calculator</a>
                                    <a href="#sample-size-calculator" class="nav-link sub-nav-link">Sample Size Calculator</a>
                                    <a href="#probability-calculator" class="nav-link sub-nav-link">Probability Calculator</a>
                                    <a href="#statistics-calculator" class="nav-link sub-nav-link">Statistics Calculator</a>
                                    <a href="#mean-median-mode-range-calculator" class="nav-link sub-nav-link">Mean, Median, Mode, Range Calculator</a>
                                    <a href="#permutation-and-combination-calculator" class="nav-link sub-nav-link">Permutation and Combination Calculator</a>
                                    <a href="#z-score-calculator" class="nav-link sub-nav-link">Z-score Calculator</a>
                                    <a href="#confidence-interval-calculator" class="nav-link sub-nav-link">Confidence Interval Calculator</a>
                                </div></details>
                            </div>
                        </details>

                        <details class="nav-category">
                            <summary><span>Financial Calculators</span><span class="arrow">▶</span></summary>
                            <div class="nav-links flex flex-col space-y-1 mt-2">
                                <a href="#401k-calculator" class="nav-link">401K Calculator</a>
                                <a href="#amortization-calculator" class="nav-link">Amortization Calculator</a>
                                <a href="#annuity-calculator" class="nav-link">Annuity Calculator</a>
                                <a href="#auto-loan-calculator" class="nav-link">Auto Loan Calculator</a>
                                <a href="#compound-interest-calculator" class="nav-link">Compound Interest Calculator</a>
                                <a href="#currency-calculator" class="nav-link">Currency Calculator</a>
                                <a href="#estate-tax-calculator" class="nav-link">Estate Tax Calculator</a>
                                <a href="#finance-calculator" class="nav-link">Finance Calculator</a>
                                <a href="#house-affordability-calculator" class="nav-link">House Affordability Calculator</a>
                                <a href="#income-tax-calculator" class="nav-link">Income Tax Calculator</a>
                                <a href="#inflation-calculator" class="nav-link">Inflation Calculator</a>
                                <a href="#interest-calculator" class="nav-link">Interest Calculator</a>
                                <a href="#interest-rate-calculator" class="nav-link">Interest Rate Calculator</a>
                                <a href="#investment-calculator" class="nav-link">Investment Calculator</a>
                                <a href="#loan-calculator" class="nav-link">Loan Calculator</a>
                                <a href="#marriage-tax-calculator" class="nav-link">Marriage Tax Calculator</a>
                                <a href="#mortgage-calculator" class="nav-link">Mortgage Calculator</a>
                                <a href="#canadian-mortgage-calculator" class="nav-link">Canadian Mortgage Calculator</a>
                                <a href="#mortgage-payoff-calculator" class="nav-link">Mortgage Payoff Calculator</a>
                                <a href="#payment-calculator" class="nav-link">Payment Calculator</a>
                                <a href="#pension-calculator" class="nav-link">Pension Calculator</a>
                                <a href="#rent-calculator" class="nav-link">Rent Calculator</a>
                                <a href="#retirement-calculator" class="nav-link">Retirement Calculator</a>
                                <a href="#salary-calculator" class="nav-link">Salary Calculator</a>
                                <a href="#sales-tax-calculator" class="nav-link">Sales Tax Calculator</a>
                                <a href="#savings-calculator" class="nav-link">Savings Calculator</a>
                                <a href="#social-security-calculator" class="nav-link">Social Security Calculator</a>
                            </div>
                        </details>

                        <details class="nav-category">
                            <summary><span>Health & Fitness</span><span class="arrow">▶</span></summary>
                            <div class="nav-links flex flex-col space-y-1 mt-2">
                                <details class="nav-subcategory" open>
                                    <summary><span>General Health Checkups</span><span class="arrow">▶</span></summary>
                                    <div class="nav-links flex flex-col space-y-1 mt-2">
                                        <a href="#bmi-calculator" class="nav-link sub-nav-link">BMI Calculator</a>
                                        <a href="#calorie-calculator" class="nav-link sub-nav-link">Calorie Calculator</a>
                                        <a href="#body-fat-calculator" class="nav-link sub-nav-link">Body Fat Calculator</a>
                                        <a href="#bmr-calculator" class="nav-link sub-nav-link">Metabolic Rate Estimator</a>
                                        <a href="#body-surface-area" class="nav-link sub-nav-link">Body Surface Estimator</a>
                                        <a href="#lean-body-mass" class="nav-link sub-nav-link">Lean Mass Checker</a>
                                        <a href="#ideal-weight" class="nav-link sub-nav-link">Ideal Body Weight Finder</a>
                                        <a href="#healthy-weight" class="nav-link sub-nav-link">Healthy Weight Range Checker</a>
                                        <a href="#body-type" class="nav-link sub-nav-link">Body Type Identifier</a>
                                        <a href="#body-water-percentage" class="nav-link sub-nav-link">Hydration Level Estimator</a>
                                        <a href="#waist-hip-ratio" class="nav-link sub-nav-link">Waist-to-Hip Ratio Tool</a>
                                        <a href="#waist-height-ratio" class="nav-link sub-nav-link">Waist-to-Height Analyzer</a>
                                    </div>
                                </details>
                                <details class="nav-subcategory" open>
                                    <summary><span>Nutrition & Daily Needs</span><span class="arrow">▶</span></summary>
                                    <div class="nav-links flex flex-col space-y-1 mt-2">
                                        <a href="#daily-calorie" class="nav-link sub-nav-link">Daily Calorie Needs Calculator</a>
                                        <a href="#macro-calculator" class="nav-link sub-nav-link">Macronutrient Split Planner</a>
                                        <a href="#protein-calculator" class="nav-link sub-nav-link">Protein Requirement Tool</a>
                                        <a href="#fat-intake" class="nav-link sub-nav-link">Fat Intake Estimator</a>
                                        <a href="#carbohydrate-calculator" class="nav-link sub-nav-link">Carb Intake Estimator</a>
                                        <a href="#tdee-calculator" class="nav-link sub-nav-link">TDEE Estimator</a>
                                        <a href="#calories-burned" class="nav-link sub-nav-link">Calories Burned Estimator</a>
                                        <a href="#weight-watcher-points" class="nav-link sub-nav-link">WW Points Calculator</a>
                                    </div>
                                </details>
                                <details class="nav-subcategory" open>
                                    <summary><span>Fitness & Exercise Tools</span><span class="arrow">▶</span></summary>
                                    <div class="nav-links flex flex-col space-y-1 mt-2">
                                        <a href="#one-rep-max" class="nav-link sub-nav-link">One Rep Max Estimator</a>
                                        <a href="#target-heart-rate" class="nav-link sub-nav-link">Target Heart Rate Finder</a>
                                        <a href="#max-heart-rate" class="nav-link sub-nav-link">Max Heart Rate Tool</a>
                                        <a href="#pace-calculator" class="nav-link sub-nav-link">Running Pace Calculator</a>
                                        <a href="#split-time" class="nav-link sub-nav-link">Split Time Tool</a>
                                        <a href="#vo2-max" class="nav-link sub-nav-link">VO2 Max Estimator</a>
                                        <a href="#mets-calculator" class="nav-link sub-nav-link">METs Activity Calculator</a>
                                        <a href="#activity-calories" class="nav-link sub-nav-link">Activity Calories Calculator</a>
                                    </div>
                                </details>
                                <details class="nav-subcategory" open>
                                    <summary><span>Women's Health & Pregnancy</span><span class="arrow">▶</span></summary>
                                    <div class="nav-links flex flex-col space-y-1 mt-2">
                                        <a href="#pregnancy-calculator" class="nav-link sub-nav-link">Pregnancy Tracker</a>
                                        <a href="#pregnancy-weight-gain" class="nav-link sub-nav-link">Weight Gain During Pregnancy</a>
                                        <a href="#pregnancy-conception" class="nav-link sub-nav-link">Conception Date Estimator</a>
                                        <a href="#due-date" class="nav-link sub-nav-link">Due Date Finder</a>
                                        <a href="#ovulation-calculator" class="nav-link sub-nav-link">Ovulation Calendar</a>
                                        <a href="#period-calculator" class="nav-link sub-nav-link">Menstrual Cycle Tracker</a>
                                    </div>
                                </details>
                                <details class="nav-subcategory" open>
                                    <summary><span>Clinical & Medical Tools</span><span class="arrow">▶</span></summary>
                                    <div class="nav-links flex flex-col space-y-1 mt-2">
                                        <a href="#gfr-calculator" class="nav-link sub-nav-link">Kidney Function (GFR) Calculator</a>
                                        <a href="#bac-calculator" class="nav-link sub-nav-link">Alcohol Level (BAC) Estimator</a>
                                        <a href="#medical-bsa" class="nav-link sub-nav-link">Medical BSA Calculator</a>
                                        <a href="#anorexic-bmi" class="nav-link sub-nav-link">Low BMI Risk Checker</a>
                                        <a href="#overweight-checker" class="nav-link sub-nav-link">Overweight Status Analyzer</a>
                                    </div>
                                </details>
                                <details class="nav-subcategory" open>
                                    <summary><span>Specialty & Miscellaneous</span><span class="arrow">▶</span></summary>
                                    <div class="nav-links flex flex-col space-y-1 mt-2">
                                        <a href="#army-body-fat" class="nav-link sub-nav-link">Army Body Fat Standard Tool</a>
                                        <a href="#bmi-for-age" class="nav-link sub-nav-link">BMI-for-Age (Teens/Kids)</a>
                                        <a href="#basal-insulin" class="nav-link sub-nav-link">Basal Insulin Estimator</a>
                                        <a href="#insulin-carb-ratio" class="nav-link sub-nav-link">Insulin-to-Carb Ratio Tool</a>
                                        <a href="#sleep-calculator" class="nav-link sub-nav-link">Optimal Sleep Time Calculator</a>
                                        <a href="#water-intake" class="nav-link sub-nav-link">Daily Water Intake Planner</a>
                                    </div>
                                </details>
                            </div>
                        </details>

                         <details class="nav-category">
                            <summary><span>Image & Media</span><span class="arrow">▶</span></summary>
                            <div class="nav-links flex flex-col space-y-1 mt-2">
                                <a href="#add-name-dob-photo" class="nav-link">Add Name & DOB to Photo</a>
                                <a href="#black-white-image" class="nav-link">Black & White Image</a>
                                <a href="#bulk-image-resizer" class="nav-link">Bulk Image Resizer</a>
                                <a href="#check-image-dpi" class="nav-link">Check Image DPI</a>
                                <a href="#circle-crop" class="nav-link">Circle Crop</a>
                                <a href="#flip-image" class="nav-link">Flip Image</a>
                                <a href="#freehand-crop" class="nav-link">Freehand Crop</a>
                                <a href="#generate-signature" class="nav-link">Generate Signature</a>
                                <a href="#gif-tools" class="nav-link">GIF Tools <span style="color: #ff9800; font-size: 0.8em;">(Under Development - May Not Produce Correct Output)</span></a>
                                <a href="#grayscale-image" class="nav-link">Grayscale Image</a>
                                <a href="#image-color-picker" class="nav-link">Image Color Picker</a>
                                <a href="#image-compressor" class="nav-link">Image Compressor</a>
                                <a href="#image-converter" class="nav-link">Image Converter</a>
                                <a href="#increase-image-size-kb" class="nav-link">Increase Image Size</a>
                                <a href="#instagram-grid-maker" class="nav-link">Instagram Grid Maker</a>
                                <a href="#join-images-one" class="nav-link">Join Images</a>
                                <a href="#passport-photo-maker" class="nav-link">Passport Photo Maker</a>
                                <a href="#picture-to-pixel-art" class="nav-link">Picture to Pixel Art</a>
                                <a href="#pixelate-image" class="nav-link">Pixelate Image</a>
                                <a href="#reduce-image-size-kb" class="nav-link">Reduce Image Size</a>
                                <a href="#remove-image-background" class="nav-link">Remove Image Background <span style="color: #ff9800; font-size: 0.8em;">(Under Development - May Not Produce Better Results)</span></a>
                                <a href="#resize-image-2x2inch" class="nav-link">Resize Image 2x2 inch</a>
                                <a href="#resize-image-35mm-45mm" class="nav-link">Resize Image 35mm x 45mm</a>
                                <a href="#resize-image-3x4" class="nav-link">Resize Image 3x4</a>
                                <a href="#resize-image-3x5cm-4x5cm" class="nav-link">Resize Image 3x5cm/4x5cm</a>
                                <a href="#resize-image-4x6" class="nav-link">Resize Image 4x6</a>
                                <a href="#resize-image-600x600" class="nav-link">Resize Image 600x600</a>
                                <a href="#resize-image-6cm-2cm-300dpi" class="nav-link">Resize Image 6cm x 2cm 300dpi</a>
                                <a href="#resize-image-a4" class="nav-link">Resize Image A4</a>
                                <a href="#resize-image-cm" class="nav-link">Resize Image (cm)</a>
                                <a href="#resize-image-inches" class="nav-link">Resize Image (inches)</a>
                                <a href="#resize-image-mm" class="nav-link">Resize Image (mm)</a>
                                <a href="#resize-image-pan-card" class="nav-link">Resize Image PAN Card</a>
                                <a href="#resize-image-pixel" class="nav-link">Resize Image (Pixels)</a>
                                <a href="#resize-image-ssc" class="nav-link">Resize Image SSC</a>
                                <a href="#resize-image-upsc" class="nav-link">Resize Image UPSC</a>
                                <a href="#resize-image-youtube-banner" class="nav-link">Resize Image YouTube Banner</a>
                                <a href="#resize-instagram-nocrop" class="nav-link">Resize Instagram No Crop</a>
                                <a href="#resize-sign-50mm-20mm" class="nav-link">Resize Sign 50mm x 20mm</a>
                                <a href="#resize-signature" class="nav-link">Resize Signature</a>
                                <a href="#resize-whatsapp-dp" class="nav-link">Resize WhatsApp DP</a>
                                <a href="#rotate-image" class="nav-link">Rotate Image</a>
                                <a href="#split-image" class="nav-link">Split Image</a>
                                <a href="#super-resolution" class="nav-link">Super Resolution</a>
                                <a href="#video-to-gif" class="nav-link">Video to GIF</a>
                                <a href="#watermark-images" class="nav-link">Watermark Images</a>
                            </div>
                        </details>
                        
                        <details class="nav-category">
                            <summary><span>General Utilities</span><span class="arrow">▶</span></summary>
                             <div class="nav-links flex flex-col space-y-1 mt-2">
                                <a href="#age-calculator" class="nav-link">Age Calculator</a>
                                <a href="#date-calculator" class="nav-link">Date Calculator</a>
                                <a href="#password-generator" class="nav-link">Password Generator</a>
                                <a href="#random-number-generator" class="nav-link">Random Number Gen</a>
                            </div>
                        </details>

                        <!-- Navigation links removed from sidebar -->
                    </nav>
                </aside>

                <!-- Dynamic Tool Content Area -->
                <main id="app-container" class="w-full md:w-3/4 lg:w-4/5 bg-white p-6 rounded-lg shadow-md border border-gray-200">
                    <!-- Tool content will be loaded here by JavaScript -->
                </main>

            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-auto border-t border-gray-200">
            <div class="container mx-auto px-4 py-4 text-center text-gray-500 text-sm">
                <div class="flex justify-center gap-6 mb-2">
                    <a href="#keymap" class="text-gray-600 hover:text-black transition-colors font-semibold">Keymap</a>
                    <a href="#about" class="text-gray-600 hover:text-black transition-colors font-semibold">About</a>
                    <a href="#feedback" class="text-gray-600 hover:text-black transition-colors font-semibold">Feedback</a>
                    <a href="#contact" class="text-gray-600 hover:text-black transition-colors font-semibold">Contact Us</a>
                </div>
                <p class="handwritten text-lg">Copyright created with ❤️ by my funny team</p>
            </div>
        </footer>
    </div>

    <!-- Popup Styles -->
    <style>
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        #chat-popup:hover .pulse {
            animation: none;
        }
    </style>

    <!-- Error Monitoring and Analytics -->
    <script>
        // Error monitoring and reporting
        window.addEventListener('error', function(e) {
            console.error('Global Error:', e.error);
            
            // Send error to analytics if available
            if (typeof gtag !== 'undefined') {
                gtag('event', 'exception', {
                    'description': e.error ? e.error.toString() : 'Unknown error',
                    'fatal': false,
                    'page_url': window.location.href,
                    'page_title': document.title
                });
            }
            
            // Optional: Send to your own error logging service
            try {
                fetch('/api/log-error', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        error: e.error ? e.error.toString() : 'Unknown error',
                        stack: e.error ? e.error.stack : '',
                        url: window.location.href,
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent
                    })
                }).catch(() => {}); // Silently fail if endpoint doesn't exist
            } catch (err) {
                console.warn('Error reporting failed:', err);
            }
        });

        // Unhandled promise rejection monitoring
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled Promise Rejection:', e.reason);
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'exception', {
                    'description': 'Unhandled Promise: ' + (e.reason ? e.reason.toString() : 'Unknown'),
                    'fatal': false,
                    'page_url': window.location.href
                });
            }
        });

        // Performance monitoring
        window.addEventListener('load', function() {
            if ('performance' in window) {
                const perfData = performance.getEntriesByType('navigation')[0];
                if (perfData && typeof gtag !== 'undefined') {
                    gtag('event', 'timing_complete', {
                        'name': 'page_load',
                        'value': Math.round(perfData.loadEventEnd - perfData.fetchStart)
                    });
                }
            }
        });

        // Track calculator usage
        function trackCalculatorUsage(calculatorName, action = 'calculate') {
            if (typeof gtag !== 'undefined') {
                gtag('event', action, {
                    'event_category': 'Calculator',
                    'event_label': calculatorName,
                    'page_url': window.location.href
                });
            }
        }

        // Track tool navigation
        function trackToolNavigation(toolName) {
            if (typeof gtag !== 'undefined') {
                gtag('event', 'tool_navigation', {
                    'event_category': 'Navigation',
                    'event_label': toolName,
                    'page_url': window.location.href
                });
            }
        }
    </script>

    <!-- Global JavaScript -->
    <script>
        const appContainer = document.getElementById('app-container');
        const toolNav = document.getElementById('tool-nav');
        const searchInput = document.getElementById('tool-search');

        // --- The Key Map of All Tools ---
        const routes = {
            // Text Tools
            '#change-case': 'client/tools/text/change-case.html', '#find-replace': 'client/tools/text/find-replace.html', '#reverse-text': 'client/tools/text/reverse-text.html', '#split-text': 'client/tools/text/split-text.html', '#join-text': 'client/tools/text/join-text.html', '#repeat-text': 'client/tools/text/repeat-text.html', '#sort-lines': 'client/tools/text/sort-lines.html', '#shuffle-lines': 'client/tools/text/shuffle-lines.html', '#remove-punctuation': 'client/tools/text/remove-punctuation.html', '#text-indenter': 'client/tools/text/text-indenter.html', '#text-dedenter': 'client/tools/text/text-dedenter.html', '#text-justifier': 'client/tools/text/text-justifier.html', '#rot13': 'client/tools/text/rot13.html', '#text-scrambler': 'client/tools/text/text-scrambler.html', '#keyword-density': 'client/tools/text/keyword-density.html', '#unique-word-finder': 'client/tools/text/unique-word-finder.html', '#readability-score': 'client/tools/text/readability-score.html', '#trim-whitespace': 'client/tools/text/trim-whitespace.html', '#align-text': 'client/tools/text/align-text.html', '#word-wrap': 'client/tools/text/word-wrap.html', '#add-line-numbers': 'client/tools/text/add-line-numbers.html', '#word-counter': 'client/tools/text/word-counter.html', '#text-statistics': 'client/tools/text/text-statistics.html', '#find-top-words': 'client/tools/text/find-top-words.html', '#change-font': 'client/tools/text/change-font.html', '#zalgo-text': 'client/tools/text/zalgo-text.html', '#image-from-text': 'client/tools/text/image-from-text.html', '#url-encode': 'client/tools/text/url-encode.html', '#base64-encode': 'client/tools/text/base64-encode.html', '#remove-duplicate-lines': 'client/tools/text/remove-duplicate-lines.html', '#morse-code': 'client/tools/text/morse-code-converter.html',
            '#json-formatter-minifier': 'client/tools/text/json-formatter-minifier.html', '#xml-formatter-minifier': 'client/tools/text/xml-formatter-minifier.html', '#csv-json-converter': 'client/tools/text/csv-json-converter.html', '#html-encode-decode': 'client/tools/text/html-encode-decode.html', '#lorem-ipsum-generator': 'client/tools/text/lorem-ipsum-generator.html', '#text-to-ascii-art': 'client/tools/text/text-to-ascii-art.html', '#text-diff-checker': 'client/tools/text/text-diff-checker.html', '#unicode-converter': 'client/tools/text/unicode-converter.html', '#binary-hex-octal-converter': 'client/tools/text/binary-hex-octal-converter.html', '#upside-down-text': 'client/tools/text/upside-down-text.html', '#mirror-text': 'client/tools/text/mirror-text.html', '#bubble-text': 'client/tools/text/bubble-text.html', '#fancy-unicode-text-generator': 'client/tools/text/fancy-unicode-text-generator.html', '#emoji-replacer-inserter': 'client/tools/text/emoji-replacer-inserter.html', '#text-to-qr-code': 'client/tools/text/text-to-qr-code.html',

            // Math Calculators
            '#basic-calculator': 'client/tools/math/basic-calculator.html',
            '#square-root-calculator': 'client/tools/math/square-root-calculator.html',
            '#exponent-calculator': 'client/tools/math/exponent-calculator.html',
            '#average-calculator': 'client/tools/math/average-calculator.html',
            '#fraction-calculator': 'client/tools/math/fraction-calculator.html',
            '#percentage-calculator': 'client/tools/math/percentage-calculator.html',
            '#discount-calculator': 'client/tools/math/discount-calculator.html',
            '#tip-calculator': 'client/tools/math/tip-calculator.html',
            '#simple-interest-calculator': 'client/tools/math/simple-interest-calculator.html',
            '#unit-price-calculator': 'client/tools/math/unit-price-calculator.html',
            '#scientific-notation-converter': 'client/tools/math/scientific-notation-converter.html',
            '#quadratic-formula': 'client/tools/math/quadratic-formula.html',
            '#area-calculator': 'client/tools/math/area-calculator.html',
            '#perimeter-calculator': 'client/tools/math/perimeter-calculator.html',
            '#volume-calculator': 'client/tools/math/volume-calculator.html',
            '#lateral-surface-area-calculator': 'client/tools/math/lateral-surface-area-calculator.html',
            '#total-surface-area-calculator': 'client/tools/math/total-surface-area-calculator.html',
            '#circle-calculator': 'client/tools/math/shapes/circle-calculator.html',
            '#triangle-calculator': 'client/tools/math/shapes/triangle-calculator.html',
            '#sphere-calculator': 'client/tools/math/shapes/sphere-calculator.html',
            '#cylinder-calculator': 'client/tools/math/shapes/cylinder-calculator.html',
            '#polygon-calculator': 'client/tools/math/shapes/polygon-calculator.html',
            '#rectangle-calculator': 'client/tools/math/shapes/rectangle-calculator.html',
            '#cuboid-calculator': 'client/tools/math/shapes/cuboid-calculator.html',
            '#standard-deviation-calculator': 'client/tools/math/standard-deviation-calculator.html',
            '#number-sequence-calculator': 'client/tools/math/number-sequence-calculator.html',
            '#sample-size-calculator': 'client/tools/math/sample-size-calculator.html',
            '#probability-calculator': 'client/tools/math/probability-calculator.html',
            '#statistics-calculator': 'client/tools/math/statistics-calculator.html',
            '#mean-median-mode-range-calculator': 'client/tools/math/mean-median-mode-range-calculator.html',
            '#permutation-and-combination-calculator': 'client/tools/math/permutation-and-combination-calculator.html',
            '#z-score-calculator': 'client/tools/math/z-score-calculator.html',
            '#confidence-interval-calculator': 'client/tools/math/confidence-interval-calculator.html',

            // Financial Calculators
            '#401k-calculator': 'client/tools/financial/401k-calculator.html',
            '#amortization-calculator': 'client/tools/financial/amortization-calculator.html',
            '#annuity-calculator': 'client/tools/financial/annuity-calculator.html',
            '#auto-loan-calculator': 'client/tools/financial/auto-loan-calculator.html',
            '#compound-interest-calculator': 'client/tools/financial/compound-interest-calculator.html',
            '#currency-calculator': 'client/tools/financial/currency-calculator.html',
            '#estate-tax-calculator': 'client/tools/financial/estate-tax-calculator.html',
            '#finance-calculator': 'client/tools/financial/finance-calculator.html',
            '#house-affordability-calculator': 'client/tools/financial/house-affordability-calculator.html',
            '#income-tax-calculator': 'client/tools/financial/income-tax-calculator.html',
            '#inflation-calculator': 'client/tools/financial/inflation-calculator.html',
            '#interest-calculator': 'client/tools/financial/interest-calculator.html',
            '#interest-rate-calculator': 'client/tools/financial/interest-rate-calculator.html',
            '#investment-calculator': 'client/tools/financial/investment-calculator.html',
            '#loan-calculator': 'client/tools/financial/loan-calculator.html',
            '#marriage-tax-calculator': 'client/tools/financial/marriage-tax-calculator.html',
            '#mortgage-calculator': 'client/tools/financial/mortgage-calculator.html',
            '#mortgage-payoff-calculator': 'client/tools/financial/mortgage-payoff-calculator.html',
            '#payment-calculator': 'client/tools/financial/payment-calculator.html',
            '#pension-calculator': 'client/tools/financial/pension-calculator.html',
            '#rent-calculator': 'client/tools/financial/rent-calculator.html',
            '#retirement-calculator': 'client/tools/financial/retirement-calculator.html',
            '#salary-calculator': 'client/tools/financial/salary-calculator.html',
            '#sales-tax-calculator': 'client/tools/financial/sales-tax-calculator.html',
            '#savings-calculator': 'client/tools/financial/savings-calculator.html',
            '#social-security-calculator': 'client/tools/financial/social-security-calculator.html',
            '#canadian-mortgage-calculator': 'client/tools/financial/Canadian-Mortgage-Calculator.html',
            '#percent-off-calculator': 'client/tools/financial/Percent-Off-Calculator.html',
            '#mortgage-amortization-calculator': 'client/tools/financial/Mortgage-Amortization-Calculator.html',
            '#mortgage-calculator-uk': 'client/tools/financial/Mortgage-Calculator-UK.html',

            // Health & Fitness
            '#all-tools': 'all-tools.html',
            '#bmi-calculator': 'client/tools/health/bmi-calculator.html',
            '#calorie-calculator': 'client/tools/health/calorie-calculator.html',
            '#body-fat-calculator': 'client/tools/health/body-fat-calculator.html',
            '#bmr-calculator': 'client/tools/health/bmr-calculator.html',
            '#body-surface-area': 'client/tools/health/body-surface-area.html',
            '#lean-body-mass': 'client/tools/health/lean-body-mass.html',
            '#ideal-weight': 'client/tools/health/ideal-weight.html',
            '#healthy-weight': 'client/tools/health/healthy-weight.html',
            '#body-type': 'client/tools/health/body-type.html',
            '#body-water-percentage': 'client/tools/health/body-water-percentage.html',
            '#waist-hip-ratio': 'client/tools/health/waist-hip-ratio.html',
            '#waist-height-ratio': 'client/tools/health/waist-height-ratio.html',
            '#daily-calorie': 'client/tools/health/daily-calorie.html',
            '#macro-calculator': 'client/tools/health/macro-calculator.html',
            '#protein-calculator': 'client/tools/health/protein-calculator.html',
            '#fat-intake': 'client/tools/health/fat-intake.html',
            '#carbohydrate-calculator': 'client/tools/health/carbohydrate-calculator.html',
            '#tdee-calculator': 'client/tools/health/tdee-calculator.html',
            '#calories-burned': 'client/tools/health/calories-burned.html',
            '#weight-watcher-points': 'client/tools/health/weight-watcher-points.html',
            '#one-rep-max': 'client/tools/health/one-rep-max.html',
            '#target-heart-rate': 'client/tools/health/target-heart-rate.html',
            '#max-heart-rate': 'client/tools/health/max-heart-rate.html',
            '#pace-calculator': 'client/tools/health/pace-calculator.html',
            '#split-time': 'client/tools/health/split-time.html',
            '#vo2-max': 'client/tools/health/vo2-max.html',
            '#mets-calculator': 'client/tools/health/mets-calculator.html',
            '#activity-calories': 'client/tools/health/activity-calories.html',
            '#pregnancy-calculator': 'client/tools/health/pregnancy-calculator.html',
            '#pregnancy-weight-gain': 'client/tools/health/pregnancy-weight-gain.html',
            '#pregnancy-conception': 'client/tools/health/pregnancy-conception.html',
            '#due-date': 'client/tools/health/due-date.html',
            '#ovulation-calculator': 'client/tools/health/ovulation-calculator.html',
            '#period-calculator': 'client/tools/health/period-calculator.html',
            '#gfr-calculator': 'client/tools/health/gfr-calculator.html',
            '#bac-calculator': 'client/tools/health/bac-calculator.html',
            '#medical-bsa': 'client/tools/health/medical-bsa.html',
            '#anorexic-bmi': 'client/tools/health/anorexic-bmi.html',
            '#overweight-checker': 'client/tools/health/overweight-checker.html',
            '#army-body-fat': 'client/tools/health/army-body-fat.html',
            '#bmi-for-age': 'client/tools/health/bmi-for-age.html',
            '#basal-insulin': 'client/tools/health/basal-insulin.html',
            '#insulin-carb-ratio': 'client/tools/health/insulin-carb-ratio.html',
            '#sleep-calculator': 'client/tools/health/sleep-calculator.html',
            '#water-intake': 'client/tools/health/water-intake.html',
            '#ideal-weight-calculator': 'client/tools/health/ideal-weight-calculator.html', '#pace-calculator': 'client/tools/health/pace-calculator.html',

            // Image & Media
            '#add-name-dob-photo': 'client/tools/image/add-name-dob-photo.html',
            '#black-white-image': 'client/tools/image/black-white-image.html',
            '#bulk-image-resizer': 'client/tools/image/bulk-image-resizer.html',
            '#check-image-dpi': 'client/tools/image/check-image-dpi.html',
            '#circle-crop': 'client/tools/image/circle-crop.html',
            '#flip-image': 'client/tools/image/flip-image.html',
            '#freehand-crop': 'client/tools/image/freehand-crop.html',
            '#grayscale-image': 'client/tools/image/grayscale-image.html',
            '#image-color-picker': 'client/tools/image/image-color-picker.html',
            '#remove-image-background': 'client/tools/image/remove-image-background.html',
            '#picture-to-pixel-art': 'client/tools/image/picture-to-pixel-art.html',
            '#instagram-grid-maker': 'client/tools/image/instagram-grid-maker.html',
            '#split-image': 'client/tools/image/split-image.html',
            '#join-images-one': 'client/tools/image/join-images-one.html',
            '#pixelate-image': 'client/tools/image/pixelate-image.html',
            '#image-converter': 'client/tools/image/image-converter.html', '#image-compressor': 'client/tools/image/image-compressor.html', '#gif-tools': 'client/tools/image/gif-tools.html', '#video-to-gif': 'client/tools/image/video-to-gif.html', '#passport-photo-maker': 'client/tools/image/passport-photo-maker.html', '#reduce-image-size-kb': 'client/tools/image/reduce-image-size-kb.html', '#resize-image-pixel': 'client/tools/image/resize-image-pixel.html', '#generate-signature': 'client/tools/image/generate-signature.html', '#increase-image-size-kb': 'client/tools/image/increase-image-size-kb.html', '#watermark-images': 'client/tools/image/watermark-images.html', '#rotate-image': 'client/tools/image/rotate-image.html', '#super-resolution': 'client/tools/image/super-resolution.html', '#resize-image-2x2inch': 'client/tools/image/resize-image-2x2inch.html', '#resize-image-3x4': 'client/tools/image/resize-image-3x4.html', '#resize-image-35mm-45mm': 'client/tools/image/resize-image-35mm-45mm.html',

            // General Utilities
            '#age-calculator': 'client/tools/other/age-calculator.html', '#date-calculator': 'client/tools/other/date-calculator.html', '#password-generator': 'client/tools/other/password-generator.html', '#random-number-generator': 'client/tools/other/random-number-generator.html', '#dice-roller': 'client/tools/other/dice-roller.html', '#gpa-calculator': 'client/tools/other/gpa-calculator.html',
        };

        const homeContent = `
            <div class="text-center p-10">
                <h1 class="handwritten text-6xl font-extrabold text-[#D9534F] mb-6 drop-shadow-lg">ScribbleTools</h1>
                <p class="text-2xl font-bold text-gray-800 mb-6 max-w-4xl mx-auto leading-relaxed">
                    The Ultimate, Ad-Free, All-in-One Toolbox for Everyone.<br>
                    <span class="block mt-4 text-3xl font-extrabold text-[#D9534F]">No ads. No clutter. Just tools.</span>
                </p>
                <div class="max-w-3xl mx-auto text-lg text-gray-700 leading-relaxed mb-8">
                    <p class="mb-4 font-semibold">ScribbleTools is your digital Swiss Army knife—an ever-growing collection of beautiful, fast, and genuinely useful online utilities for text, math, finance, health, and more. We built this site because we were tired of slow, ad-filled, and confusing utility websites. Here, you get:</p>
                    <ul class="list-disc list-inside text-left mb-4">
                        <li><b>Lightning-fast</b> tools that load instantly and work offline</li>
                        <li><b>Zero ads, zero tracking, zero distractions</b></li>
                        <li><b>Modern, hand-drawn design</b> that makes work feel fun</li>
                        <li><b>Privacy-first</b>: Everything runs in your browser, your data never leaves your device</li>
                        <li><b>Constantly expanding</b>—new tools and calculators added all the time</li>
                    </ul>
                    <p class="mb-4">Whether you’re a student, developer, teacher, or just someone who needs to get things done, ScribbleTools is designed to help you work smarter, not harder. From text manipulation to financial planning, from math crunching to health tracking, it’s all here—free, forever.</p>
                    <p class="mb-4 font-semibold text-[#D9534F] text-xl">Select a tool from the menu to get started, or use the search bar to find exactly what you need.</p>
                </div>
                <div class="mt-8 p-8 bg-amber-50/70 rounded-xl border-2 border-amber-300 shadow-lg max-w-2xl mx-auto">
                    <h2 class="font-extrabold text-2xl text-amber-800 mb-3">Why ScribbleTools?</h2>
                    <ul class="list-disc list-inside text-lg text-gray-800">
                        <li>All-in-one: Text, math, finance, health, and more</li>
                        <li>Hand-drawn, joyful design—utility doesn’t have to be boring</li>
                        <li>Open to suggestions: <b>Tell us what to build next!</b></li>
                        <li>Made with ❤️ by a team that cares about your experience</li>
                    </ul>
                </div>
            </div>
        `;
        
        const aboutContent = `
             <div class="p-8 space-y-8">
                <div>
                    <h2 class="handwritten text-5xl text-[#D9534F] mb-4 text-center">About ScribbleTools</h2>
                    <p class="text-gray-600 leading-relaxed max-w-3xl mx-auto text-center">
                        ScribbleTools is your all-in-one, distraction-free toolbox for text, math, finance, health, and more. Born from the frustration of ad-filled, clunky utility sites, we set out to build a collection of beautiful, fast, and genuinely useful online tools that people actually enjoy using.<br><br>
                        <strong>What makes us different?</strong> We focus on speed, clarity, and a delightful hand-drawn aesthetic. Every tool is crafted to be intuitive, lightweight, and free of unnecessary clutter. Whether you’re a student, developer, teacher, or just someone who needs to get things done, ScribbleTools is designed to help you work smarter, not harder.
                    </p>
                </div>

                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h3 class="handwritten text-4xl text-gray-800 mb-3">Our Philosophy</h3>
                        <p class="text-gray-600 leading-relaxed">
                            <strong>Simplicity is Key:</strong> Every tool is designed to be intuitive and straightforward. No confusing interfaces, no unnecessary steps. Just the functionality you need, presented clearly.<br><br>
                            <strong>Speed Matters:</strong> Your time is valuable. Our tools are built with modern, lightweight web technologies to ensure they load instantly and perform calculations in a flash.<br><br>
                            <strong>A Joy to Use:</strong> Utility doesn’t have to be boring. With a unique, hand-drawn aesthetic, we aim to make your daily tasks a little more delightful.<br><br>
                            <strong>Privacy First:</strong> We don’t track you, store your data, or show you ads. Everything runs in your browser for maximum privacy and speed.
                        </p>
                    </div>
                    <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbXN0eXNqZzZpZ2ZkN2Q0cGJmZzF3b2l1bTdzc2U5N2N6eXFtdnNqZSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3o7btNa0RUYa5E7iiQ/giphy.gif" class="rounded-lg shadow-md w-full h-auto object-cover" alt="Creative Process GIF">
                </div>

                 <div class="grid md:grid-cols-2 gap-8 items-center">
                    <img src="https://media.tenor.com/o6HowXvQwW8AAAAM/think-big-think.gif" class="rounded-lg shadow-md w-full h-auto object-cover" alt="Community GIF">
                    <div>
                        <h3 class="handwritten text-4xl text-gray-800 mb-3">Why So Many Tools?</h3>
                        <p class="text-gray-600 leading-relaxed">
                           We believe in thinking big. Why create one tool when you can build a comprehensive library? Our goal is to be the single destination for any quick calculation, conversion, or text manipulation you might need. By building this extensive collection, we aim to create a truly indispensable resource for a wide audience.<br><br>
                           <strong>Always Growing:</strong> This project is a labor of love, and we’re constantly scribbling down new ideas for utilities to add. If you have a suggestion, let us know!
                        </p>
                    </div>
                </div>
                <div class="mt-8 p-6 bg-amber-50/50 rounded-lg border border-amber-200 max-w-3xl mx-auto">
                    <h3 class="font-semibold text-lg text-amber-800 mb-3">What can you do here?</h3>
                    <ul class="list-disc list-inside text-gray-700">
                        <li>Manipulate, analyze, and format text in dozens of ways</li>
                        <li>Calculate loans, mortgages, investments, and more</li>
                        <li>Crunch numbers with math and science calculators</li>
                        <li>Track your health, fitness, and nutrition</li>
                        <li>Convert, encode, and decode data</li>
                        <li>And much more—no ads, no tracking, just tools</li>
                    </ul>
                </div>
            </div>
        `;
        
        const contactContent = `
             <div class="p-8">
                <h2 class="handwritten text-5xl text-[#D9534F] mb-4">Contact Us</h2>
                <p class="text-gray-600 leading-relaxed">Have a suggestion for a new tool or feedback on an existing one? We'd love to hear from you. Please feel free to reach out to our team.</p>
                <form action="https://formsubmit.co/your@email.com" method="POST" class="mt-6 space-y-4">
                    <input type="hidden" name="_subject" value="New Contact Message from ScribbleTools!">
                    <input type="hidden" name="_next" value="${window.location.href}">
                    <input type="email" name="email" class="w-full p-3 bg-gray-50 rounded-md border border-gray-300" placeholder="Your Email" required>
                    <textarea name="message" class="w-full p-3 bg-gray-50 rounded-md border border-gray-300" rows="4" placeholder="Your message..." required></textarea>
                    <button type="submit" class="w-full bg-[#D9534F] hover:bg-red-600 text-white font-bold py-3 rounded-md">Send Message</button>
                </form>
            </div>
        `;

        const feedbackContent = `
             <div class="p-8">
                <h2 class="handwritten text-5xl text-[#D9534F] mb-4">Submit Feedback</h2>
                <p class="text-gray-600 leading-relaxed">Your feedback is valuable to us! Please let us know if you've found a bug, have a suggestion for a new tool, or have any other comments.</p>
                <form action="https://formsubmit.co/your@email.com" method="POST" class="mt-6 space-y-4">
                    <input type="hidden" name="_subject" value="New Feedback from ScribbleTools!">
                    <input type="hidden" name="_next" value="${window.location.href}">
                    <div>
                        <label for="feedback-type" class="block text-sm font-medium text-gray-700 mb-1">Feedback Type</label>
                        <select id="feedback-type" name="feedback_type" class="w-full p-3 bg-gray-50 rounded-md border border-gray-300">
                            <option>Suggestion for a New Tool</option>
                            <option>Bug Report</option>
                            <option>General Feedback</option>
                        </select>
                    </div>
                    <textarea name="feedback_message" class="w-full p-3 bg-gray-50 rounded-md border border-gray-300" rows="5" placeholder="Your feedback..." required></textarea>
                    <button type="submit" class="w-full bg-[#D9534F] hover:bg-red-600 text-white font-bold py-3 rounded-md">Submit Feedback</button>
                </form>
            </div>
        `;

        const requestToolContent = `
            <div class="p-8 max-w-3xl mx-auto">
                <h2 class="handwritten text-5xl text-[#D9534F] mb-4 text-center">📝 Request a Tool</h2>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <span class="text-2xl">💡</span>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-lg font-semibold text-blue-800 mb-2">Quick vs. Detailed Requests</h3>
                            <p class="text-blue-700 text-sm mb-2"><strong>💬 Chat Widget:</strong> Perfect for quick, simple ideas like "password checker" or "unit converter"</p>
                            <p class="text-blue-700 text-sm"><strong>📝 This Page:</strong> For detailed requests with specific features, requirements, and use cases</p>
                        </div>
                    </div>
                </div>
                <p class="text-gray-700 text-lg mb-6 text-center">Need a comprehensive tool with specific features? Tell us exactly what you need, why you need it, and how it should work. We love building detailed solutions!</p>
                <form action="https://formsubmit.co/your@email.com" method="POST" class="space-y-6 bg-white rounded-lg shadow-md border border-gray-200 p-6">
                    <input type="hidden" name="_subject" value="Detailed Tool Request from ScribbleTools!">
                    <input type="hidden" name="_next" value="${window.location.href}">
                    <div>
                        <label class="block text-gray-800 font-semibold mb-2" for="tool_name">Tool Name *</label>
                        <input type="text" id="tool_name" name="tool_name" class="w-full p-3 bg-gray-50 rounded-md border border-gray-300" placeholder="e.g., Advanced Mortgage Calculator with PMI" required>
                    </div>
                    <div>
                        <label class="block text-gray-800 font-semibold mb-2" for="tool_category">Category</label>
                        <select id="tool_category" name="tool_category" class="w-full p-3 bg-gray-50 rounded-md border border-gray-300">
                            <option value="">Select a category...</option>
                            <option value="text">Text Tools</option>
                            <option value="math">Math Calculators</option>
                            <option value="financial">Financial Calculators</option>
                            <option value="health">Health & Fitness</option>
                            <option value="image">Image & Media</option>
                            <option value="utility">General Utilities</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-800 font-semibold mb-2" for="tool_description">Detailed Description *</label>
                        <textarea id="tool_description" name="tool_description" class="w-full p-3 bg-gray-50 rounded-md border border-gray-300" rows="4" placeholder="Describe what the tool should do, what inputs it needs, and what outputs it should provide..." required></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-800 font-semibold mb-2" for="use_case">Why do you need this tool?</label>
                        <textarea id="use_case" name="use_case" class="w-full p-3 bg-gray-50 rounded-md border border-gray-300" rows="3" placeholder="What problem would this solve? How would you use it? Who else might benefit?"></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-800 font-semibold mb-2" for="specific_features">Specific Features (Optional)</label>
                        <textarea id="specific_features" name="specific_features" class="w-full p-3 bg-gray-50 rounded-md border border-gray-300" rows="3" placeholder="List any specific features, calculations, or functionality you'd like to see..."></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-800 font-semibold mb-2" for="contact_email">Your Email (Optional)</label>
                        <input type="email" id="contact_email" name="contact_email" class="w-full p-3 bg-gray-50 rounded-md border border-gray-300" placeholder="We'll contact you when the tool is ready!">
                    </div>
                    <button type="submit" class="w-full bg-[#D9534F] hover:bg-red-600 text-white font-bold py-4 rounded-md text-lg transition-colors">Submit Detailed Request</button>
                    <p class="text-sm text-gray-500 text-center mt-4">💡 For quick, simple ideas, try our chat widget in the bottom-right corner!</p>
                </form>
            </div>
        `;

        async function loadContent(path) {
            console.log('loadContent called with path:', path);
            console.log('Current location:', window.location.href);
            
            // Clear any existing intervals or timeouts to prevent memory leaks
            for (let i = 1; i < 99999; i++) {
                window.clearInterval(i);
                window.clearTimeout(i);
            }
            
            appContainer.innerHTML = '<div class="flex justify-center items-center h-full"><div class="spinner"></div></div>';
            try {
                console.log('Fetching:', path);
                const response = await fetch(path);
                console.log('Fetch response:', response.status, response.ok, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
                }
                
                const html = await response.text();
                console.log('HTML received, length:', html.length);
                console.log('HTML starts with:', html.substring(0, 100));

                // Create a temporary container to parse the HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;

                // Remove all <script> tags from the tempDiv and collect them
                const scripts = Array.from(tempDiv.querySelectorAll('script'));
                scripts.forEach(script => script.parentNode.removeChild(script));

                // Inject the rest of the HTML into the app container
                appContainer.innerHTML = '';
                while (tempDiv.firstChild) {
                    appContainer.appendChild(tempDiv.firstChild);
                }

                // Clean up existing tool scripts to prevent conflicts
                const existingToolScripts = document.querySelectorAll('script[data-tool-script]');
                existingToolScripts.forEach(script => script.remove());

                // Run scripts with proper cleanup and initialization
                function runScriptsWithQRCodeCheck(scripts) {
                    function runScripts() {
                        scripts.forEach(oldScript => {
                            const newScript = document.createElement('script');
                            newScript.setAttribute('data-tool-script', 'true'); // Mark as tool script for cleanup
                            
                            if (oldScript.src) {
                                newScript.src = oldScript.src;
                                newScript.onload = () => {
                                    // Script loaded, check for initialization functions
                                    setTimeout(() => checkAndInitializeTool(path), 150);
                                };
                                newScript.onerror = () => {
                                    console.warn('Failed to load script:', oldScript.src);
                                };
                            } else {
                                // For inline scripts, ensure DOM elements are available
                                const wrappedScript = "(function(){\ntry{\n" + oldScript.textContent + "\n}catch(error){\nconsole.error('Tool script error:', error);\n}\n})();";
                                newScript.textContent = wrappedScript;
                            }
                            
                            Array.from(oldScript.attributes).forEach(attr => {
                                if (attr.name !== 'data-tool-script') {
                                    newScript.setAttribute(attr.name, attr.value);
                                }
                            });
                            document.body.appendChild(newScript);
                        });
                        
                        // For inline scripts, check initialization after a short delay to ensure DOM is ready
                        if (scripts.some(script => !script.src)) {
                            setTimeout(() => checkAndInitializeTool(path), 300);
                        }
                    }
                    
                    if (typeof QRCode !== 'undefined') {
                        runScripts();
                    } else {
                        // Wait for QRCode to be available
                        const interval = setInterval(() => {
                            if (typeof QRCode !== 'undefined') {
                                clearInterval(interval);
                                runScripts();
                            }
                        }, 50);
                    }
                }

                // Centralized tool initialization function
                function checkAndInitializeTool(path) {
                    // Wait a bit more for DOM and scripts to be fully ready
                    setTimeout(() => {
                        // Image tools
                        if (path.includes('image-compressor') && window.initializeImageCompressor) {
                            window.initializeImageCompressor();
                        } else if (path.includes('image-converter') && window.initializeImageConverter) {
                            window.initializeImageConverter();
                        } else if (path.includes('passport-photo-maker') && window.initializePassportPhotoMaker) {
                            window.initializePassportPhotoMaker();
                        } else if (path.includes('reduce-image-size-kb') && window.initializeReduceImageSize) {
                            window.initializeReduceImageSize();
                        } else if (path.includes('resize-image-pixel') && window.initializeResizeImagePixel) {
                            window.initializeResizeImagePixel();
                        } else if (path.includes('generate-signature') && window.initializeGenerateSignature) {
                            window.initializeGenerateSignature();
                        } else if (path.includes('increase-image-size-kb') && window.initializeIncreaseImageSize) {
                            window.initializeIncreaseImageSize();
                        } else if (path.includes('watermark-images') && window.initializeWatermarkImages) {
                            window.initializeWatermarkImages();
                        } else if (path.includes('rotate-image') && window.initializeRotateImage) {
                            window.initializeRotateImage();
                        } else if (path.includes('gif-tools') && window.initializeGIFTools) {
                            window.initializeGIFTools();
                        } else if (path.includes('grayscale-image') && window.initializeGrayscaleImageTool) {
                            window.initializeGrayscaleImageTool();
                        } else if (path.includes('image-color-picker') && window.initializeImageColorPickerTool) {
                            window.initializeImageColorPickerTool();
                        } else if (path.includes('remove-image-background') && window.initializeRemoveImageBackgroundTool) {
                            window.initializeRemoveImageBackgroundTool();
                        } else if (path.includes('picture-to-pixel-art') && window.initializePictureToPixelArtTool) {
                            window.initializePictureToPixelArtTool();
                        } else if (path.includes('black-white-image') && window.initializeBlackWhiteImageTool) {
                            window.initializeBlackWhiteImageTool();
                        } else if (path.includes('circle-crop') && window.initializeCircleCropTool) {
                            window.initializeCircleCropTool();
                        } else if (path.includes('flip-image') && window.initializeFlipImageTool) {
                            window.initializeFlipImageTool();
                        } else if (path.includes('add-name-dob-photo') && window.initializeAddNameDobTool) {
                            console.log('🏷️ Initializing Add Name & DOB Tool...');
                            window.initializeAddNameDobTool();
                            console.log('✅ Add Name & DOB Tool initialized');
                                                } else if (path.includes('gif-tools') && window.initializeGifTools) {
                            window.initializeGifTools();
                        }
                        // Financial tools
                        else if (path.includes('Canadian-Mortgage-Calculator') && window.initializeCanadianMortgageCalculator) {
                            window.initializeCanadianMortgageCalculator();
                        } else if (path.includes('sales-tax-calculator') && window.initializeSalesTaxCalculator) {
                            window.initializeSalesTaxCalculator();
                        } else if (path.includes('salary-calculator') && window.initializeSalaryCalculator) {
                            window.initializeSalaryCalculator();
                        }
                        // Health tools
                        else if (path.includes('ideal-weight-calculator') && window.initializeIdealWeightCalculator) {
                            window.initializeIdealWeightCalculator();
                        }
                        // Add more tool initializations as needed
                        
                        // For tools without specific initialization functions, try generic initialization
                        if (typeof initializeTool === 'function') {
                            initializeTool();
                        }
                        
                        // For tools that don't have specific initialization, ensure basic event listeners are working
                        // Re-trigger any click event handlers that might have been added in the scripts
                        const buttons = appContainer.querySelectorAll('button, input[type="button"], .calc-btn');
                        buttons.forEach(button => {
                            // Check if button already has event listeners by trying to trigger events
                            const event = new Event('initCheck');
                            button.dispatchEvent(event);
                        });
                        
                        // Trigger a custom event to notify tools they can initialize
                        const toolLoadedEvent = new CustomEvent('toolLoaded', { detail: { path: path } });
                        document.dispatchEvent(toolLoadedEvent);
                    }, 200);
                }
                runScriptsWithQRCodeCheck(scripts);
                
                // Fallback initialization for tools that might need extra time
                setTimeout(() => checkAndInitializeTool(path), 500);
            } catch (error) {
                console.error("Failed to load content:", error);
                console.error("Path was:", path);
                console.error("Error details:", error.message, error.stack);
                appContainer.innerHTML = `<p class="text-red-500 text-center">Sorry, we couldn't load this tool. Error: ${error.message}</p>`;
            }
        }

        function router() {
            console.log('Router called with hash:', window.location.hash);
            const hash = window.location.hash || '#home'; // Default to #home
            const path = routes[hash];
            console.log('Looking for path:', path, 'for hash:', hash);
            
            // Track tool navigation
            if (hash !== '#home') {
                trackToolNavigation(hash.replace('#', ''));
            }
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.toggle('active', link.getAttribute('href') === hash);
            });

            if (path) {
                console.log('Loading content from path:', path);
                loadContent(path);
            } else if (hash === '#about') {
                appContainer.innerHTML = aboutContent;
            } else if (hash === '#blogs') {
                appContainer.innerHTML = `
                <div class="p-8 max-w-3xl mx-auto">
                    <h2 class="handwritten text-5xl text-[#D9534F] mb-6 text-center">Blogs</h2>
                    <div class="mb-8 text-center text-gray-700 text-lg">Thoughts and articles on AI, education, and more.</div>
                    <div class="space-y-8">
                        <!-- Example Blog Post -->
                        <article class="bg-white rounded-lg shadow border border-gray-200 p-6">
                            <h3 class="text-2xl font-bold text-[#D9534F] mb-2">Why AI Matters in Modern Education</h3>
                            <div class="text-gray-500 text-sm mb-2">Posted on 2024-06-01</div>
                            <p class="text-gray-700 mb-2">Artificial Intelligence is transforming the way we learn, teach, and interact with information. In this post, we explore the impact of AI on education, from personalized learning to smart content creation.</p>
                            <a href="#" class="text-[#D9534F] hover:underline font-semibold">Read more</a>
                        </article>
                        <!-- Add more blog posts below -->
                        <article class="bg-white rounded-lg shadow border border-gray-200 p-6">
                            <h3 class="text-2xl font-bold text-[#D9534F] mb-2">The Future of Learning: Blending Technology and Creativity</h3>
                            <div class="text-gray-500 text-sm mb-2">Posted on 2024-05-20</div>
                            <p class="text-gray-700 mb-2">Education is evolving rapidly. Discover how technology, creativity, and human-centered design are shaping the classrooms of tomorrow.</p>
                            <a href="#" class="text-[#D9534F] hover:underline font-semibold">Read more</a>
                        </article>
                    </div>
                    <div class="mt-10 text-center text-gray-500">Want to contribute? Email us your blog ideas!</div>
                </div>
                `;
            } else if (hash === '#contact') {
                appContainer.innerHTML = contactContent;
            } else if (hash === '#feedback') {
                appContainer.innerHTML = feedbackContent;
            } else if (hash === '#request-tool') {
                appContainer.innerHTML = requestToolContent;
            } else {
                appContainer.innerHTML = homeContent;
            }
        }
        
        // --- Search Functionality ---
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const allLinks = document.querySelectorAll('.nav-link');
            
            allLinks.forEach(link => {
                const linkText = link.textContent.toLowerCase();
                const parentDetails = link.closest('details');
                const subCategory = link.closest('.nav-subcategory');

                if (linkText.includes(searchTerm)) {
                    link.style.display = 'block';
                    if (parentDetails) parentDetails.open = true;
                    if (subCategory) subCategory.open = true;
                } else {
                    link.style.display = 'none';
                }
            });

            // Hide categories if all links within are hidden
            document.querySelectorAll('.nav-category').forEach(category => {
                const visibleLinks = category.querySelectorAll('.nav-link[style*="display: block"]');
                if (visibleLinks.length === 0) {
                    category.style.display = 'none';
                } else {
                    category.style.display = 'block';
                }
            });
        });

        // Chat system variables
        let chatOpen = false;
        let chatWindow = null;
        let chatInput = null;
        let chatSend = null;
        let chatMessages = null;
        let chatAutocomplete = null;
        let allChatMessages = [];
        let selectedAutocompleteIndex = -1;
        
        // Ground rules for the platform
        const groundRules = {
            chat: {
                maxMessageLength: 500,
                cooldownPeriod: 2000, // 2 seconds between messages
                bannedWords: ['spam', 'abuse', 'inappropriate'],
                maxMessagesPerHour: 50
            },
            tools: {
                maxFileSize: 50 * 1024 * 1024, // 50MB
                allowedFileTypes: ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'text/plain', 'text/csv'],
                rateLimit: 100 // requests per hour
            },
            admin: {
                canModerateChat: true,
                canDeleteMessages: true,
                canBanUsers: true,
                canAccessAnalytics: true,
                canManageTools: true
            }
        };

        // Create tool suggestions from routes
        const toolSuggestions = Object.keys(routes).map(route => {
            const toolName = route.replace('#', '').replace(/-/g, ' ');
            const category = getToolCategory(route);
            return {
                name: toolName,
                route: route,
                category: category,
                icon: getToolIcon(category)
            };
        });

        // Additional autocomplete suggestions (200+ total)
        const extraSuggestions = [
            // Popular tools and requests
            { name: 'tool', icon: '🔧', category: 'General' },
            { name: 'calculator', icon: '🔢', category: 'Math' },
            { name: 'converter', icon: '🔄', category: 'Utility' },
            { name: 'generator', icon: '⚡', category: 'Utility' },
            { name: 'checker', icon: '✅', category: 'Utility' },
            { name: 'analyzer', icon: '📊', category: 'Utility' },
            { name: 'formatter', icon: '📝', category: 'Text' },
            { name: 'compressor', icon: '📦', category: 'Image' },
            { name: 'resizer', icon: '📏', category: 'Image' },
            { name: 'editor', icon: '✏️', category: 'Text' },
            
            // Common tool requests
            { name: 'password generator', icon: '🔐', category: 'Security' },
            { name: 'qr code generator', icon: '📱', category: 'Utility' },
            { name: 'color picker', icon: '🎨', category: 'Image' },
            { name: 'unit converter', icon: '📐', category: 'Math' },
            { name: 'currency converter', icon: '💱', category: 'Finance' },
            { name: 'json formatter', icon: '📄', category: 'Text' },
            { name: 'base64 encoder', icon: '🔤', category: 'Text' },
            { name: 'url shortener', icon: '🔗', category: 'Utility' },
            { name: 'hash generator', icon: '🔢', category: 'Security' },
            { name: 'timestamp converter', icon: '⏰', category: 'Utility' },
            
            // Health tools
            { name: 'calorie counter', icon: '🍎', category: 'Health' },
            { name: 'water intake calculator', icon: '💧', category: 'Health' },
            { name: 'sleep calculator', icon: '😴', category: 'Health' },
            { name: 'bmi tracker', icon: '⚖️', category: 'Health' },
            { name: 'workout planner', icon: '💪', category: 'Health' },
            { name: 'heart rate monitor', icon: '❤️', category: 'Health' },
            { name: 'nutrition tracker', icon: '🥗', category: 'Health' },
            { name: 'fitness calculator', icon: '🏃', category: 'Health' },
            
            // Finance tools
            { name: 'budget calculator', icon: '💰', category: 'Finance' },
            { name: 'loan calculator', icon: '🏦', category: 'Finance' },
            { name: 'tax calculator', icon: '📊', category: 'Finance' },
            { name: 'investment tracker', icon: '📈', category: 'Finance' },
            { name: 'savings calculator', icon: '🏦', category: 'Finance' },
            { name: 'expense tracker', icon: '💳', category: 'Finance' },
            { name: 'mortgage calculator', icon: '🏠', category: 'Finance' },
            { name: 'retirement planner', icon: '🏖️', category: 'Finance' },
            
            // Text tools
            { name: 'word counter', icon: '📝', category: 'Text' },
            { name: 'text analyzer', icon: '🔍', category: 'Text' },
            { name: 'plagiarism checker', icon: '📋', category: 'Text' },
            { name: 'grammar checker', icon: '✏️', category: 'Text' },
            { name: 'spell checker', icon: '📖', category: 'Text' },
            { name: 'text translator', icon: '🌐', category: 'Text' },
            { name: 'markdown editor', icon: '📄', category: 'Text' },
            { name: 'regex tester', icon: '🔧', category: 'Text' },
            
            // Image tools
            { name: 'photo editor', icon: '🖼️', category: 'Image' },
            { name: 'background remover', icon: '🖼️', category: 'Image' },
            { name: 'image optimizer', icon: '⚡', category: 'Image' },
            { name: 'photo filters', icon: '🎨', category: 'Image' },
            { name: 'image cropper', icon: '✂️', category: 'Image' },
            { name: 'watermark tool', icon: '💧', category: 'Image' },
            { name: 'gif maker', icon: '🎬', category: 'Image' },
            { name: 'meme generator', icon: '😂', category: 'Image' },
            
            // Developer tools
            { name: 'code formatter', icon: '💻', category: 'Developer' },
            { name: 'api tester', icon: '🔌', category: 'Developer' },
            { name: 'css generator', icon: '🎨', category: 'Developer' },
            { name: 'html validator', icon: '✅', category: 'Developer' },
            { name: 'minifier', icon: '📦', category: 'Developer' },
            { name: 'beautifier', icon: '✨', category: 'Developer' },
            { name: 'sql formatter', icon: '🗄️', category: 'Developer' },
            { name: 'xml parser', icon: '📄', category: 'Developer' },
            
            // Utility tools
            { name: 'habit tracker', icon: '📅', category: 'Utility' },
            { name: 'todo list', icon: '✅', category: 'Utility' },
            { name: 'timer', icon: '⏱️', category: 'Utility' },
            { name: 'stopwatch', icon: '⏰', category: 'Utility' },
            { name: 'pomodoro timer', icon: '🍅', category: 'Utility' },
            { name: 'reminder app', icon: '🔔', category: 'Utility' },
            { name: 'note taker', icon: '📓', category: 'Utility' },
            { name: 'voice recorder', icon: '🎤', category: 'Utility' },
            
            // Educational tools
            { name: 'flashcards', icon: '📚', category: 'Education' },
            { name: 'quiz maker', icon: '❓', category: 'Education' },
            { name: 'study planner', icon: '📅', category: 'Education' },
            { name: 'grade calculator', icon: '📊', category: 'Education' },
            { name: 'citation generator', icon: '📖', category: 'Education' },
            { name: 'research helper', icon: '🔍', category: 'Education' },
            { name: 'learning tracker', icon: '📈', category: 'Education' },
            { name: 'presentation maker', icon: '📽️', category: 'Education' },
            
            // Popular requests
            { name: 'dark mode', icon: '🌙', category: 'Feature' },
            { name: 'mobile app', icon: '📱', category: 'Feature' },
            { name: 'offline mode', icon: '📱', category: 'Feature' },
            { name: 'export feature', icon: '📤', category: 'Feature' },
            { name: 'import feature', icon: '📥', category: 'Feature' },
            { name: 'save to cloud', icon: '☁️', category: 'Feature' },
            { name: 'keyboard shortcuts', icon: '⌨️', category: 'Feature' },
            { name: 'user accounts', icon: '👤', category: 'Feature' },
            
            // More specific tools
            { name: 'isbn checker', icon: '📚', category: 'Utility' },
            { name: 'credit card validator', icon: '💳', category: 'Utility' },
            { name: 'email validator', icon: '📧', category: 'Utility' },
            { name: 'phone number formatter', icon: '📞', category: 'Utility' },
            { name: 'zip code lookup', icon: '📮', category: 'Utility' },
            { name: 'weather widget', icon: '🌤️', category: 'Utility' },
            { name: 'world clock', icon: '🌍', category: 'Utility' },
            { name: 'timezone converter', icon: '🕐', category: 'Utility' },
            
            // Common chat words and greetings
            { name: 'hello', icon: '👋', category: 'Chat' },
            { name: 'hi', icon: '👋', category: 'Chat' },
            { name: 'hey', icon: '👋', category: 'Chat' },
            { name: 'good morning', icon: '🌅', category: 'Chat' },
            { name: 'good afternoon', icon: '☀️', category: 'Chat' },
            { name: 'good evening', icon: '🌆', category: 'Chat' },
            { name: 'good night', icon: '🌙', category: 'Chat' },
            { name: 'thanks', icon: '🙏', category: 'Chat' },
            { name: 'thank you', icon: '🙏', category: 'Chat' },
            { name: 'please', icon: '🙏', category: 'Chat' },
            { name: 'welcome', icon: '🤗', category: 'Chat' },
            { name: 'awesome', icon: '🌟', category: 'Chat' },
            { name: 'amazing', icon: '🤩', category: 'Chat' },
            { name: 'great', icon: '👍', category: 'Chat' },
            { name: 'cool', icon: '😎', category: 'Chat' },
            { name: 'nice', icon: '👌', category: 'Chat' },
            { name: 'perfect', icon: '✨', category: 'Chat' },
            { name: 'excellent', icon: '💯', category: 'Chat' },
            { name: 'love it', icon: '❤️', category: 'Chat' },
            { name: 'help', icon: '🆘', category: 'Chat' },
            { name: 'question', icon: '❓', category: 'Chat' },
            { name: 'idea', icon: '💡', category: 'Chat' },
            { name: 'suggestion', icon: '🎯', category: 'Chat' },
            { name: 'feedback', icon: '📝', category: 'Chat' },
            { name: 'bug report', icon: '🐛', category: 'Chat' },
            { name: 'feature request', icon: '⭐', category: 'Chat' },
            { name: 'how to', icon: '🤔', category: 'Chat' },
            { name: 'tutorial', icon: '📚', category: 'Chat' },
            { name: 'guide', icon: '🗺️', category: 'Chat' },
            { name: 'documentation', icon: '📖', category: 'Chat' },
            { name: 'examples', icon: '📋', category: 'Chat' },
            { name: 'demo', icon: '🎬', category: 'Chat' },
            { name: 'test', icon: '🧪', category: 'Chat' },
            { name: 'working', icon: '✅', category: 'Chat' },
            { name: 'not working', icon: '❌', category: 'Chat' },
            { name: 'broken', icon: '💔', category: 'Chat' },
            { name: 'fixed', icon: '🔧', category: 'Chat' },
            { name: 'updated', icon: '🔄', category: 'Chat' },
            { name: 'new', icon: '🆕', category: 'Chat' },
            { name: 'old', icon: '📜', category: 'Chat' },
            { name: 'fast', icon: '⚡', category: 'Chat' },
            { name: 'slow', icon: '🐌', category: 'Chat' },
            { name: 'easy', icon: '😊', category: 'Chat' },
            { name: 'difficult', icon: '😅', category: 'Chat' },
            { name: 'simple', icon: '🎯', category: 'Chat' },
            { name: 'complex', icon: '🧩', category: 'Chat' },
            { name: 'useful', icon: '👍', category: 'Chat' },
            { name: 'useless', icon: '👎', category: 'Chat' },
            { name: 'important', icon: '⚠️', category: 'Chat' },
            { name: 'urgent', icon: '🚨', category: 'Chat' },
            { name: 'priority', icon: '🔥', category: 'Chat' },
            { name: 'later', icon: '⏰', category: 'Chat' },
            { name: 'now', icon: '⚡', category: 'Chat' },
            { name: 'today', icon: '📅', category: 'Chat' },
            { name: 'tomorrow', icon: '📆', category: 'Chat' },
            { name: 'yesterday', icon: '📋', category: 'Chat' },
            { name: 'soon', icon: '🔜', category: 'Chat' },
            { name: 'maybe', icon: '🤷', category: 'Chat' },
            { name: 'definitely', icon: '💯', category: 'Chat' },
            { name: 'probably', icon: '🤔', category: 'Chat' },
            { name: 'yes', icon: '✅', category: 'Chat' },
            { name: 'no', icon: '❌', category: 'Chat' },
            { name: 'okay', icon: '👌', category: 'Chat' },
            { name: 'alright', icon: '👍', category: 'Chat' },
            { name: 'sure', icon: '✨', category: 'Chat' },
            { name: 'absolutely', icon: '💯', category: 'Chat' },
            { name: 'exactly', icon: '🎯', category: 'Chat' },
            { name: 'totally', icon: '💯', category: 'Chat' },
            { name: 'completely', icon: '✅', category: 'Chat' },
            { name: 'really', icon: '😮', category: 'Chat' },
            { name: 'seriously', icon: '😤', category: 'Chat' },
            { name: 'actually', icon: '🤓', category: 'Chat' },
            { name: 'honestly', icon: '😇', category: 'Chat' },
            { name: 'basically', icon: '📝', category: 'Chat' },
            { name: 'generally', icon: '🌐', category: 'Chat' },
            { name: 'specifically', icon: '🎯', category: 'Chat' },
            { name: 'especially', icon: '⭐', category: 'Chat' },
            { name: 'particularly', icon: '🔍', category: 'Chat' },
            { name: 'mainly', icon: '🎯', category: 'Chat' },
            { name: 'mostly', icon: '📊', category: 'Chat' },
            { name: 'sometimes', icon: '🔄', category: 'Chat' },
            { name: 'always', icon: '♾️', category: 'Chat' },
            { name: 'never', icon: '🚫', category: 'Chat' },
            { name: 'often', icon: '🔁', category: 'Chat' },
            { name: 'rarely', icon: '🔸', category: 'Chat' },
            { name: 'frequently', icon: '📈', category: 'Chat' },
            { name: 'occasionally', icon: '🎲', category: 'Chat' }
        ];

        // Combine all suggestions
        const allSuggestions = [...toolSuggestions, ...extraSuggestions];

        // Auto-response messages for community engagement
        const autoResponses = [
            "That's a great idea! 👍",
            "I've been looking for something like that too!",
            "Would love to see this implemented 🚀",
            "This could be really useful for students!",
            "Perfect for productivity! ⚡",
            "Great suggestion! Hope the devs see this 👀",
            "I use tools like this daily, would be awesome here!",
            "This would save me so much time! ⏰",
            "Brilliant idea! 💡",
            "Yes please! This is exactly what I need 🙏",
            "Amazing suggestion! Can't wait to try it",
            "This would be a game changer! 🎮",
            "Such a practical tool idea! 🛠️",
            "I'd use this every day! 📅",
            "Great thinking! Very useful 🧠",
            "Love this concept! ❤️",
            "This would help so many people! 👥",
            "Fantastic idea! Keep them coming! 🌟",
            "So needed! Hope it gets built soon 🤞",
            "This is why I love this community! 🤝"
        ];

        function getToolCategory(route) {
            if (route.includes('text')) return 'Text';
            if (route.includes('math')) return 'Math';
            if (route.includes('financial')) return 'Finance';
            if (route.includes('health')) return 'Health';
            if (route.includes('image')) return 'Image';
            return 'Utility';
        }

        function getToolIcon(category) {
            const icons = {
                'Text': '📝',
                'Math': '🔢',
                'Finance': '💰',
                'Health': '🏥',
                'Image': '🖼️',
                'Utility': '🛠️',
                'Security': '🔐',
                'Developer': '💻',
                'Education': '📚',
                'Feature': '⚡',
                'General': '🔧',
                'Chat': '💬'
            };
            return icons[category] || '🔧';
        }

        // Initialize with some sample public messages
        const sampleMessages = [
            { user: "Alex", message: "Just tried the @bmi-calculator.html - works perfectly! 💪", timestamp: new Date(Date.now() - 3600000) },
            { user: "Sarah", message: "@tool need a habit tracker for daily routines", timestamp: new Date(Date.now() - 1800000) },
            { user: "Mike", message: "The @gif-tools.html is getting better! When will it be fully ready?", timestamp: new Date(Date.now() - 900000) },
            { user: "DevTeam", message: "Working on @gif-tools.html improvements! Thanks for the feedback 🛠️", timestamp: new Date(Date.now() - 600000), isAdmin: true }
        ];

        function toggleChat() {
            // Simplified chat toggle without authentication
            if (!chatWindow) {
                console.log('Chat window not found');
                return;
            }
            
            chatOpen = !chatOpen;
            chatWindow.style.display = chatOpen ? 'flex' : 'none';
            if (chatOpen) {
                loadChatHistory();
                if (chatInput) chatInput.focus();
            }
        }

        // Simplified notification function

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-lg text-white font-medium ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
            }`;
            notification.textContent = message; // Removed sanitizeInput dependency
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Chat functions without authentication requirements
        let lastMessageTime = 0;
        let messagesThisHour = 0;
        let hourStartTime = Date.now();

        function addMessage(message, isUser = false, username = null, isAdmin = false, skipStorage = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${isUser ? 'user' : 'bot'}`;
            
            // Store message for persistence and download (only if not loading from storage)
            if (!skipStorage) {
                const messageData = {
                    message: message,
                    isUser: isUser,
                    username: username,
                    isAdmin: isAdmin,
                    timestamp: new Date().toISOString(),
                    hasMention: message.includes('@')
                };
                allChatMessages.push(messageData);
                saveChatToStorage();
            }
            
            if (isUser && username) {
                // Format user messages with username - brighter colors for better visibility
                const userColor = isAdmin ? '#ff4500' : '#ffffff'; // Bright orange for admin, white for regular users
                const userBadge = isAdmin ? '👨‍💻' : '👤';
                messageDiv.innerHTML = `<strong style="color: ${userColor}; text-shadow: 0 1px 2px rgba(0,0,0,0.5); font-weight: 700;">${userBadge} ${username}:</strong><br>${highlightMentions(message)}`;
            } else if (!isUser) {
                // Bot/system messages
                messageDiv.innerHTML = message;
            } else {
                // Simple user message without username
                messageDiv.innerHTML = highlightMentions(message);
            }
            
            // Only append to DOM if chatMessages element exists
            if (chatMessages) {
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        function highlightMentions(text) {
            // Highlight @tool mentions
            text = text.replace(/@tool\b/gi, '<span style="background: #fef3c7; color: #92400e; padding: 2px 4px; border-radius: 4px; font-weight: bold;">@tool</span>');
            
            // Highlight @filename.html mentions
            text = text.replace(/@([a-zA-Z0-9-_]+\.html)\b/gi, '<span style="background: #dbeafe; color: #1d4ed8; padding: 2px 4px; border-radius: 4px; font-weight: bold;">@$1</span>');
            
            // Highlight other @mentions
            text = text.replace(/@([a-zA-Z0-9-_]+)\b/gi, '<span style="background: #f3e8ff; color: #7c3aed; padding: 2px 4px; border-radius: 4px; font-weight: bold;">@$1</span>');
            
            return text;
        }

        async function loadChatHistory() {
            // Only load chat history if chat elements exist
            if (!chatMessages) {
                console.log('Chat elements not available, skipping chat history load');
                return;
            }
            
            try {
                // Load from localStorage only (no backend authentication)
                const savedChat = localStorage.getItem('scribbletools_chat');
                if (savedChat) {
                    allChatMessages = JSON.parse(savedChat);
                } else {
                    // Initialize with sample messages if no saved chat
                    allChatMessages = sampleMessages.map(msg => ({
                        message: msg.message,
                        isUser: true,
                        username: msg.user,
                        isAdmin: msg.isAdmin || false,
                        timestamp: msg.timestamp.toISOString(),
                        hasMention: msg.message.includes('@')
                    }));
                    saveChatToStorage();
                }
                
                // Clear current messages except welcome message
                const welcomeMessage = chatMessages.querySelector('.chat-message.bot');
                chatMessages.innerHTML = '';
                if (welcomeMessage) {
                    chatMessages.appendChild(welcomeMessage);
                }
                
                // Load all saved messages
                allChatMessages.forEach(msg => {
                    addMessageToDisplay(msg.message, msg.isUser, msg.username, msg.isAdmin);
                });
                
            } catch (error) {
                console.error('Error loading chat history:', error);
            }
        }

        function addMessageToDisplay(message, isUser = false, username = null, isAdmin = false) {
            // Use addMessage with skipStorage=true to avoid duplicating in storage
            addMessage(message, isUser, username, isAdmin, true);
        }

        function saveChatToStorage() {
            localStorage.setItem('scribbletools_chat', JSON.stringify(allChatMessages));
        }

        function downloadMentionChats() {
            // Filter messages that contain @ mentions
            const mentionMessages = allChatMessages.filter(msg => msg.hasMention);
            
            if (mentionMessages.length === 0) {
                alert('No messages with @ mentions found!');
                return;
            }

            // Prepare data for Excel
            const excelData = [];
            
            // Add header row
            excelData.push(['Timestamp', 'Username', 'Message', 'Type', 'Has Mention', 'Response 1', 'Response 2']);
            
            // Process each mention message and find the next 2 responses
            mentionMessages.forEach((mentionMsg, index) => {
                const mentionIndex = allChatMessages.findIndex(msg => 
                    msg.timestamp === mentionMsg.timestamp && msg.username === mentionMsg.username
                );
                
                // Get the next 2 messages as responses
                const response1 = allChatMessages[mentionIndex + 1] || null;
                const response2 = allChatMessages[mentionIndex + 2] || null;
                
                // Format the row data
                const row = [
                    new Date(mentionMsg.timestamp).toLocaleString(),
                    mentionMsg.username || 'System',
                    mentionMsg.message.replace(/<[^>]*>/g, ''), // Remove HTML tags
                    mentionMsg.isAdmin ? 'Admin' : (mentionMsg.isUser ? 'User' : 'System'),
                    'Yes',
                    response1 ? `${response1.username || 'System'}: ${response1.message.replace(/<[^>]*>/g, '')}` : '',
                    response2 ? `${response2.username || 'System'}: ${response2.message.replace(/<[^>]*>/g, '')}` : ''
                ];
                
                excelData.push(row);
            });

            // Convert to CSV format
            const csvContent = excelData.map(row => 
                row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
            ).join('\n');

            // Create and download the file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `scribbletools_mention_chats_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function clearChatHistory() {
            if (confirm('Are you sure you want to clear all chat history? This cannot be undone.')) {
                allChatMessages = [];
                localStorage.removeItem('scribbletools_chat');
                loadChatHistory();
            }
        }

        function generateRandomUsername() {
            const adjectives = ['Cool', 'Smart', 'Quick', 'Bright', 'Happy', 'Swift', 'Sharp', 'Clever'];
            const nouns = ['User', 'Coder', 'Helper', 'Builder', 'Maker', 'Thinker', 'Creator'];
            const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
            const noun = nouns[Math.floor(Math.random() * nouns.length)];
            return `${adj}${noun}${Math.floor(Math.random() * 99)}`;
        }

        function detectMentionType(message) {
            if (message.toLowerCase().includes('@tool')) {
                return 'tool';
            } else if (message.match(/@[a-zA-Z0-9-_]+\.html/i)) {
                return 'file';
            } else if (message.match(/@[a-zA-Z0-9-_]+/i)) {
                return 'general';
            }
            return 'chat';
        }

        function handleCommunityMessage(message) {
            const username = generateRandomUsername();
            const mentionType = detectMentionType(message);
            
            // Add user message
            addMessage(message, true, username);
            
            // Check for greeting messages and auto-respond
            const lowerMessage = message.toLowerCase().trim();
            const greetings = ['hi', 'hello', 'hey', 'good morning', 'good afternoon', 'good evening', 'good night'];
            const isGreeting = greetings.some(greeting => 
                lowerMessage === greeting || 
                lowerMessage.startsWith(greeting + ' ') || 
                lowerMessage.startsWith(greeting + '!')
            );
            
            if (isGreeting) {
                const greetingResponses = [
                    "Hi there! 👋 Welcome to ScribbleTools community chat!",
                    "Hello! 😊 Great to see you here! Feel free to share tool ideas or ask questions.",
                    "Hey! 🌟 Hope you're having a great day! What brings you to our tools community?",
                    "Hi! 👋 Welcome! Check out our amazing tools or suggest new ones with @tool",
                    "Hello and welcome! 🎉 Our community loves sharing tool ideas and feedback!",
                    "Hey there! 😄 Nice to meet you! Don't hesitate to mention @tool for suggestions.",
                    "Hi! 🚀 Welcome to the ScribbleTools family! What's your favorite type of tool?",
                    "Hello! ⭐ Great to have you here! Our community is always buzzing with new ideas!"
                ];
                
                setTimeout(() => {
                    const randomGreeting = greetingResponses[Math.floor(Math.random() * greetingResponses.length)];
                    addMessage(randomGreeting, false);
                }, 500 + Math.random() * 300);
                
                // Add a second community member response for greetings
                setTimeout(() => {
                    const communityUser = generateRandomUsername();
                    const communityGreetings = [
                        "Welcome to the community! 🤗",
                        "Hi! Hope you find some useful tools here! 👍",
                        "Hey! This community has the best tool suggestions! 🌟",
                        "Welcome! Feel free to ask if you need help finding anything! 😊",
                        "Hi there! The tools here have saved me so much time! ⏰",
                        "Hey! Great to see new faces in our community! 🎉"
                    ];
                    const communityResponse = communityGreetings[Math.floor(Math.random() * communityGreetings.length)];
                    addMessage(communityResponse, true, communityUser);
                }, 1200 + Math.random() * 800);
                
                return; // Skip the default response system for greetings
            }
            
            // Generate appropriate response based on mention type
            setTimeout(() => {
                let response = '';
                
                switch (mentionType) {
                    case 'tool':
                        const toolIdea = message.replace(/@tool\s*/i, '').trim();
                        response = `💡 Great tool idea "${toolIdea}"! Added to our community suggestions. Other users can vote on this in our development board! 🗳️`;
                        break;
                        
                    case 'file':
                        const fileName = message.match(/@([a-zA-Z0-9-_]+\.html)/i)?.[1];
                        response = `📁 Thanks for the feedback on <strong>${fileName}</strong>! Our dev team monitors these mentions for improvements. Keep the suggestions coming! 🔧`;
                        break;
                        
                    case 'general':
                        response = `👋 Thanks for joining the community discussion! Feel free to share ideas, feedback, or chat with other ScribbleTools users!`;
                        break;
                        
                    default:
                        response = `🌐 Message shared with the community! Other users can see and respond to your message.`;
                }
                
                addMessage(response, false);
            }, 800 + Math.random() * 400);

            // Enhanced auto-response system - more frequent responses
            if (Math.random() < 0.6) { // 60% chance of user response
                setTimeout(() => {
                    const otherUser = generateRandomUsername();
                    const randomResponse = autoResponses[Math.floor(Math.random() * autoResponses.length)];
                    addMessage(randomResponse, true, otherUser);
                }, 1500 + Math.random() * 2500);
            }

            // Additional responses for tool mentions (more engagement)
            if (mentionType === 'tool' && Math.random() < 0.4) {
                setTimeout(() => {
                    const supportiveUser = generateRandomUsername();
                    const supportResponses = [
                        "Upvoted! This would be so useful! 👍",
                        "Yes! I was just thinking about this yesterday!",
                        "The devs should definitely prioritize this! 🎯",
                        "I'd use this feature daily! Great idea! 📅",
                        "This community has the best suggestions! 🌟",
                        "Hope this gets built soon! 🚀"
                    ];
                    const supportResponse = supportResponses[Math.floor(Math.random() * supportResponses.length)];
                    addMessage(supportResponse, true, supportiveUser);
                }, 3000 + Math.random() * 3000);
            }

            // Occasional admin/developer responses
            if ((mentionType === 'tool' || mentionType === 'file') && Math.random() < 0.15) {
                setTimeout(() => {
                    const devResponses = [
                        "We're looking into this! Thanks for the suggestion 🛠️",
                        "Added to our roadmap! Stay tuned for updates 📋",
                        "Great feedback! We'll discuss this in our next dev meeting 👨‍💻",
                        "This aligns with our plans! Thanks for confirming the need 🎯",
                        "Love seeing community engagement like this! Keep it coming! 💪"
                    ];
                    const devResponse = devResponses[Math.floor(Math.random() * devResponses.length)];
                    addMessage(devResponse, true, "DevTeam", true); // true for admin
                }, 4000 + Math.random() * 4000);
            }
        }

        async function sendMessage() {
            // Check if chat input exists (may not exist on main page)
            if (!chatInput) {
                console.warn('sendMessage called but chatInput not found');
                return;
            }
            
            const message = chatInput.value.trim();
            if (!message) return;

            // Simple message validation (no authentication needed)
            if (message.length > 500) {
                showNotification('Message too long! Maximum 500 characters.', 'warning');
                return;
            }

            hideAutocomplete();
            
            // Use a generated username since no authentication
            const username = generateRandomUsername();
            const mentionType = detectMentionType(message);
            
            // Add user message
            addMessage(message, true, username, false);
            
            // Clear input
            chatInput.value = '';
            
            // Check for greeting messages and auto-respond
            const lowerMessage = message.toLowerCase().trim();
            const greetings = ['hi', 'hello', 'hey', 'good morning', 'good afternoon', 'good evening', 'good night'];
            const isGreeting = greetings.some(greeting => 
                lowerMessage === greeting || 
                lowerMessage.startsWith(greeting + ' ') || 
                lowerMessage.startsWith(greeting + '!')
            );
            
            if (isGreeting) {
                const greetingResponses = [
                    `Hi ${username}! 👋 Welcome to ScribbleTools community chat!`,
                    `Hello ${username}! 😊 Great to see you here! Feel free to share tool ideas or ask questions.`,
                    `Hey ${username}! 🌟 Hope you're having a great day! What brings you to our tools community?`,
                    `Hi ${username}! 👋 Welcome! Check out our amazing tools or suggest new ones with @tool`,
                    `Hello and welcome ${username}! 🎉 Our community loves sharing tool ideas and feedback!`,
                    `Hey there ${username}! 😄 Nice to meet you! Don't hesitate to mention @tool for suggestions.`,
                    `Hi ${username}! 🚀 Welcome to the ScribbleTools family! What's your favorite type of tool?`,
                    `Hello ${username}! ⭐ Great to have you here! Our community is always buzzing with new ideas!`
                ];
                
                setTimeout(() => {
                    const randomGreeting = greetingResponses[Math.floor(Math.random() * greetingResponses.length)];
                    addMessage(randomGreeting, false);
                }, 500 + Math.random() * 300);
                
                // Add a second community member response for greetings
                setTimeout(() => {
                    const communityUser = generateRandomUsername();
                    const communityGreetings = [
                        `Welcome to the community ${username}! 🤗`,
                        `Hi ${username}! Hope you find some useful tools here! 👍`,
                        `Hey ${username}! This community has the best tool suggestions! 🌟`,
                        `Welcome ${username}! Feel free to ask if you need help finding anything! 😊`,
                        `Hi there ${username}! The tools here have saved me so much time! ⏰`,
                        `Hey ${username}! Great to see new faces in our community! 🎉`
                    ];
                    const communityResponse = communityGreetings[Math.floor(Math.random() * communityGreetings.length)];
                    addMessage(communityResponse, true, communityUser);
                }, 1200 + Math.random() * 800);
                
                chatInput.value = '';
                chatInput.style.height = 'auto';
                return; // Skip the default response system for greetings
            }
            
            // Generate appropriate response based on mention type
            setTimeout(() => {
                let response = '';
                
                switch (mentionType) {
                    case 'tool':
                        const toolIdea = message.replace(/@tool\s*/i, '').trim();
                        response = `💡 Great tool idea "${toolIdea}" from ${username}! Added to our community suggestions. Other users can vote on this in our development board! 🗳️`;
                        break;
                        
                    case 'file':
                        const fileName = message.match(/@([a-zA-Z0-9-_]+\.html)/i)?.[1];
                        response = `📁 Thanks for the feedback on <strong>${fileName}</strong>, ${username}! Our dev team monitors these mentions for improvements. Keep the suggestions coming! 🔧`;
                        break;
                        
                    case 'general':
                        response = `👋 Thanks for joining the community discussion, ${username}! Feel free to share ideas, feedback, or chat with other ScribbleTools users!`;
                        break;
                        
                    default:
                        response = `🌐 Message from ${username} shared with the community! Other users can see and respond to your message.`;
                }
                
                addMessage(response, false);
            }, 800 + Math.random() * 400);

            // Enhanced auto-response system - more frequent responses for authenticated users
            if (Math.random() < 0.7) { // 70% chance of user response for authenticated users
                setTimeout(() => {
                    const otherUser = generateRandomUsername();
                    const randomResponse = autoResponses[Math.floor(Math.random() * autoResponses.length)];
                    addMessage(`@${username} ${randomResponse}`, true, otherUser);
                }, 1500 + Math.random() * 2500);
            }

            // Additional responses for tool mentions (more engagement)
            if (mentionType === 'tool' && Math.random() < 0.5) {
                setTimeout(() => {
                    const supportiveUser = generateRandomUsername();
                    const supportResponses = [
                        `@${username} Upvoted! This would be so useful! 👍`,
                        `@${username} Yes! I was just thinking about this yesterday!`,
                        `@${username} The devs should definitely prioritize this! 🎯`,
                        `@${username} I'd use this feature daily! Great idea! 📅`,
                        `@${username} This community has the best suggestions! 🌟`,
                        `@${username} Hope this gets built soon! 🚀`
                    ];
                    const supportResponse = supportResponses[Math.floor(Math.random() * supportResponses.length)];
                    addMessage(supportResponse, true, supportiveUser);
                }, 3000 + Math.random() * 3000);
            }

            // Occasional admin/developer responses
            if ((mentionType === 'tool' || mentionType === 'file') && Math.random() < 0.2) {
                setTimeout(() => {
                    const devResponses = [
                        `@${username} We're looking into this! Thanks for the suggestion 🛠️`,
                        `@${username} Added to our roadmap! Stay tuned for updates 📋`,
                        `@${username} Great feedback! We'll discuss this in our next dev meeting 👨‍💻`,
                        `@${username} This aligns with our plans! Thanks for confirming the need 🎯`,
                        `@${username} Love seeing community engagement like this! Keep it coming! 💪`
                    ];
                    const devResponse = devResponses[Math.floor(Math.random() * devResponses.length)];
                    addMessage(devResponse, true, "DevTeam", true); // true for admin
                }, 4000 + Math.random() * 4000);
            }

            // Clear input if it exists
            if (chatInput) {
                chatInput.value = '';
                chatInput.style.height = 'auto';
            }
        }

        function showAutocomplete(suggestions) {
            if (!chatAutocomplete || suggestions.length === 0) {
                hideAutocomplete();
                return;
            }

            chatAutocomplete.innerHTML = '';
            suggestions.slice(0, 8).forEach((suggestion, index) => {
                const item = document.createElement('div');
                item.className = 'autocomplete-item';
                if (index === selectedAutocompleteIndex) {
                    item.classList.add('selected');
                }
                item.innerHTML = `
                    <span class="autocomplete-icon">${suggestion.icon}</span>
                    <span>${suggestion.name}</span>
                    <small style="margin-left: auto; opacity: 0.7;">${suggestion.category}</small>
                `;
                item.addEventListener('click', () => {
                    insertSuggestion(suggestion.name);
                });
                chatAutocomplete.appendChild(item);
            });

            chatAutocomplete.style.display = 'block';
        }

        function hideAutocomplete() {
            if (chatAutocomplete) {
                chatAutocomplete.style.display = 'none';
            }
            selectedAutocompleteIndex = -1;
        }

        function insertSuggestion(suggestionName) {
            if (!chatInput) return;
            
            const cursorPos = chatInput.selectionStart;
            const textBefore = chatInput.value.substring(0, cursorPos);
            const textAfter = chatInput.value.substring(cursorPos);
            
            // Check if we're completing an @ mention
            const atIndex = textBefore.lastIndexOf('@');
            if (atIndex !== -1 && !textBefore.substring(atIndex + 1).includes(' ')) {
                // @ mention completion
                const newText = textBefore.substring(0, atIndex + 1) + suggestionName + ' ' + textAfter;
                chatInput.value = newText;
                const newCursorPos = atIndex + suggestionName.length + 2;
                chatInput.setSelectionRange(newCursorPos, newCursorPos);
            } else {
                // Regular word completion
                const words = textBefore.split(' ');
                const currentWordIndex = words.length - 1;
                words[currentWordIndex] = suggestionName;
                const newText = words.join(' ') + ' ' + textAfter;
                chatInput.value = newText;
                const newCursorPos = words.join(' ').length + 1;
                chatInput.setSelectionRange(newCursorPos, newCursorPos);
            }
            
            hideAutocomplete();
            chatInput.focus();
        }

        function handleAutocompleteInput() {
            if (!chatInput) return;
            
            const cursorPos = chatInput.selectionStart;
            const textBefore = chatInput.value.substring(0, cursorPos);
            
            // Find the last @ symbol before cursor
            const atIndex = textBefore.lastIndexOf('@');
            
            if (atIndex === -1) {
                // Regular chat autocomplete (without @)
                const words = textBefore.split(' ');
                const currentWord = words[words.length - 1].toLowerCase();
                
                if (currentWord.length >= 2) {
                    // Filter chat suggestions and tools
                    const chatSuggestions = allSuggestions.filter(suggestion =>
                        suggestion.name.toLowerCase().startsWith(currentWord) ||
                        suggestion.name.toLowerCase().includes(currentWord)
                    );
                    
                    if (chatSuggestions.length > 0) {
                        showAutocomplete(chatSuggestions);
                    } else {
                        hideAutocomplete();
                    }
                } else {
                    hideAutocomplete();
                }
                return;
            }

            // Get text after @ symbol
            const afterAt = textBefore.substring(atIndex + 1);
            
            // Check if there's a space after @, if so, hide autocomplete
            if (afterAt.includes(' ')) {
                hideAutocomplete();
                return;
            }

            // Filter suggestions based on input
            const filteredSuggestions = allSuggestions.filter(suggestion =>
                suggestion.name.toLowerCase().includes(afterAt.toLowerCase())
            );

            if (afterAt.length > 0) {
                showAutocomplete(filteredSuggestions);
            } else {
                // Show popular suggestions when just @ is typed
                const popularSuggestions = [
                    { name: 'tool', icon: '🔧', category: 'General' },
                    { name: 'calculator', icon: '🔢', category: 'Math' },
                    { name: 'password generator', icon: '�', category: 'Security' },
                    { name: 'bmi calculator', icon: '🏥', category: 'Health' },
                    { name: 'text counter', icon: '📝', category: 'Text' },
                    { name: 'image compressor', icon: '📦', category: 'Image' },
                    { name: 'budget calculator', icon: '�', category: 'Finance' },
                    { name: 'habit tracker', icon: '📅', category: 'Utility' }
                ];
                showAutocomplete(popularSuggestions);
            }
        }

        // Community Chat functions removed

        function showChatNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed bottom-20 right-6 z-40 px-4 py-2 rounded-lg text-white font-medium shadow-lg transform transition-all duration-300 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            }`;
            notification.textContent = message;
            notification.style.transform = 'translateY(100px) scale(0.8)';
            notification.style.opacity = '0';
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateY(0) scale(1)';
                notification.style.opacity = '1';
            }, 50);
            
            // Remove after 2 seconds
            setTimeout(() => {
                notification.style.transform = 'translateY(100px) scale(0.8)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 2000);
        }

        // Initialize chat system
        function initializeChat() {
            // Initialize chat DOM elements (they may not exist in main page)
            chatWindow = document.getElementById('chatWindow');
            chatInput = document.getElementById('chatInput');
            chatSend = document.getElementById('chatSend');
            chatMessages = document.getElementById('chatMessages');
            chatAutocomplete = document.getElementById('chatAutocomplete');
            
            // Only set up event listeners if chat elements exist
            if (chatInput && chatSend) {
                chatSend.addEventListener('click', sendMessage);
                chatInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
                chatInput.addEventListener('input', handleAutocompleteInput);
            }
            
            // Load chat history if available
            loadChatHistory();
        }

        // Event listeners
        window.addEventListener('hashchange', router);
        window.addEventListener('DOMContentLoaded', router);
        
        // Initialize chat system on page load
        window.addEventListener('DOMContentLoaded', initializeChat);
        
        // Simple periodic cleanup (no authentication needed)
        setInterval(() => {
            // Just clear any old temporary data occasionally
            const oldData = localStorage.getItem('temp_data');
            if (oldData) {
                try {
                    const data = JSON.parse(oldData);
                    const currentTime = Date.now();
                    
                    // Clean up data older than 24 hours
                    if (data.timestamp && currentTime - data.timestamp > 86400000) {
                        localStorage.removeItem('temp_data');
                    }
                } catch (error) {
                    localStorage.removeItem('temp_data');
                }
            }
        }, 60 * 60 * 1000); // Check every hour
    </script>

</body>
</html>
