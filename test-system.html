<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScribbleTools - System Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 py-8">
    <div class="max-w-4xl mx-auto px-4">
        <h1 class="text-3xl font-bold text-center mb-8">ScribbleTools System Test</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Database Connection Test</h2>
            <button id="test-db" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Test Database Connection
            </button>
            <div id="db-result" class="mt-4 p-4 rounded hidden"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Click Tracking Test</h2>
            <button id="test-click" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                Test Click Tracking
            </button>
            <div id="click-result" class="mt-4 p-4 rounded hidden"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Statistics Test</h2>
            <button id="test-stats" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                Test Statistics Retrieval
            </button>
            <div id="stats-result" class="mt-4 p-4 rounded hidden"></div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Marquee Test</h2>
            <p class="text-gray-600 mb-4">Check if the desktop marquee is visible (desktop only):</p>
            <div class="hidden md:block bg-gradient-to-r from-blue-600 to-purple-600 text-white py-2 overflow-hidden rounded">
                <div class="marquee-content whitespace-nowrap">
                    üñ•Ô∏è Test Marquee: Best experience on desktop! Mobile users can access all tools, but desktop provides optimal functionality ‚ú®
                </div>
            </div>
            <p class="text-sm text-gray-500 mt-2">This marquee should only be visible on desktop screens (768px+)</p>
        </div>
    </div>

    <style>
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .marquee-content {
            display: inline-block;
            animation: marquee 20s linear infinite;
            font-size: 14px;
            font-weight: 500;
        }
    </style>

    <script>
        // Test database connection
        document.getElementById('test-db').addEventListener('click', async () => {
            const resultDiv = document.getElementById('db-result');
            resultDiv.className = 'mt-4 p-4 rounded bg-blue-100 text-blue-800';
            resultDiv.textContent = 'Testing database connection...';
            resultDiv.classList.remove('hidden');

            try {
                const response = await fetch('/api/track-click.php?action=stats&limit=1');
                const data = await response.json();

                if (response.ok && data.success !== false) {
                    resultDiv.className = 'mt-4 p-4 rounded bg-green-100 text-green-800';
                    resultDiv.textContent = '‚úÖ Database connection successful!';
                } else {
                    resultDiv.className = 'mt-4 p-4 rounded bg-red-100 text-red-800';
                    resultDiv.textContent = `‚ùå Database connection failed: ${data.error || 'Unknown error'}`;
                }
            } catch (error) {
                resultDiv.className = 'mt-4 p-4 rounded bg-red-100 text-red-800';
                resultDiv.textContent = `‚ùå Connection error: ${error.message}`;
            }
        });

        // Test click tracking
        document.getElementById('test-click').addEventListener('click', async () => {
            const resultDiv = document.getElementById('click-result');
            resultDiv.className = 'mt-4 p-4 rounded bg-blue-100 text-blue-800';
            resultDiv.textContent = 'Testing click tracking...';
            resultDiv.classList.remove('hidden');

            try {
                const response = await fetch('/api/track-click.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        tool_name: 'Test Tool',
                        tool_path: 'test/test-tool.html',
                        tool_category: 'Test Tools'
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    resultDiv.className = 'mt-4 p-4 rounded bg-green-100 text-green-800';
                    resultDiv.textContent = `‚úÖ Click tracking successful! Total clicks: ${data.click_count}`;
                } else {
                    resultDiv.className = 'mt-4 p-4 rounded bg-red-100 text-red-800';
                    resultDiv.textContent = `‚ùå Click tracking failed: ${data.error || 'Unknown error'}`;
                }
            } catch (error) {
                resultDiv.className = 'mt-4 p-4 rounded bg-red-100 text-red-800';
                resultDiv.textContent = `‚ùå Tracking error: ${error.message}`;
            }
        });

        // Test statistics retrieval
        document.getElementById('test-stats').addEventListener('click', async () => {
            const resultDiv = document.getElementById('stats-result');
            resultDiv.className = 'mt-4 p-4 rounded bg-blue-100 text-blue-800';
            resultDiv.textContent = 'Testing statistics retrieval...';
            resultDiv.classList.remove('hidden');

            try {
                const [toolsResponse, categoriesResponse] = await Promise.all([
                    fetch('/api/track-click.php?action=stats&limit=5'),
                    fetch('/api/track-click.php?action=categories')
                ]);

                const toolsData = await toolsResponse.json();
                const categoriesData = await categoriesResponse.json();

                if (toolsData.success && categoriesData.success) {
                    resultDiv.className = 'mt-4 p-4 rounded bg-green-100 text-green-800';
                    resultDiv.innerHTML = `
                        <div>‚úÖ Statistics retrieval successful!</div>
                        <div class="mt-2">
                            <strong>Tools tracked:</strong> ${toolsData.data.length}<br>
                            <strong>Categories:</strong> ${categoriesData.data.length}
                        </div>
                        ${toolsData.data.length > 0 ? `
                            <div class="mt-2">
                                <strong>Top tool:</strong> ${toolsData.data[0].tool_name} (${toolsData.data[0].click_count} clicks)
                            </div>
                        ` : ''}
                    `;
                } else {
                    resultDiv.className = 'mt-4 p-4 rounded bg-red-100 text-red-800';
                    resultDiv.textContent = `‚ùå Statistics retrieval failed`;
                }
            } catch (error) {
                resultDiv.className = 'mt-4 p-4 rounded bg-red-100 text-red-800';
                resultDiv.textContent = `‚ùå Statistics error: ${error.message}`;
            }
        });

        // Check screen size
        function checkScreenSize() {
            const screenInfo = document.createElement('div');
            screenInfo.className = 'mt-4 p-4 bg-gray-100 rounded';
            screenInfo.innerHTML = `
                <strong>Screen Size:</strong> ${window.innerWidth}px √ó ${window.innerHeight}px<br>
                <strong>Device Type:</strong> ${window.innerWidth >= 768 ? 'Desktop (marquee visible)' : 'Mobile (marquee hidden)'}
            `;
            document.body.appendChild(screenInfo);
        }

        // Run screen size check on load
        window.addEventListener('load', checkScreenSize);
    </script>
</body>
</html>